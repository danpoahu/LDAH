<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="LDAH">
  <meta name="theme-color" content="#004E7C">
  <title>LDAH - Events</title>
  
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-32PRRS0W85"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-32PRRS0W85');
  </script>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <!-- iOS Icons -->
  <link rel="apple-touch-icon" href="https://danpoahu.github.io/LDAH/icon-192.png">
  
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow-x: hidden;
    }
    
    body {
      margin: 0;
      padding: 0;
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: url('https://danpoahu.github.io/LDAH/background.png') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      min-height: -webkit-fill-available;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Icons
    const Menu = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="3" y1="6" x2="21" y2="6"></line>
        <line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    );

    const X = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const ChevronLeft = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    );

    const Calendar = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );

    const Clock = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
    );

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAU3CQ07bCVKlJ1qGak-150kaJEyPKldLk",
      authDomain: "ldah-932d5.firebaseapp.com",
      projectId: "ldah-932d5",
      storageBucket: "ldah-932d5.firebasestorage.app",
      messagingSenderId: "662130454003",
      appId: "1:662130454003:web:437576d5a5811ecd8df686"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const db = firebase.firestore();
    const auth = firebase.auth();

    auth.signInAnonymously().catch(error => {
      console.error('Anonymous auth failed:', error);
    });

    const EventsApp = () => {
      const [events, setEvents] = useState([]);
      const [loading, setLoading] = useState(true);
      const [selectedEvent, setSelectedEvent] = useState(null);
      const [currentIndex, setCurrentIndex] = useState(0);
      const [isPastEvents, setIsPastEvents] = useState(false);
      const [menuOpen, setMenuOpen] = useState(false);

      useEffect(() => {
        const unsubscribe = db.collection('events')
          .onSnapshot(snapshot => {
            const eventList = snapshot.docs.map(doc => ({ 
              id: doc.id, 
              ...doc.data() 
            }));
            setEvents(eventList);
            setLoading(false);
          }, error => {
            console.error('Error loading events:', error);
            setLoading(false);
          });

        return () => unsubscribe();
      }, []);

      const formatDate = (dateString) => {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
          month: 'long', 
          day: 'numeric', 
          year: 'numeric' 
        });
      };

      const isEventCurrent = (event) => {
        const now = new Date();
        const startDate = new Date(event.startDate);
        const moveToPastDate = new Date(event.moveToPastDate);
        return now >= startDate && now < moveToPastDate;
      };

      const isEventPast = (event) => {
        const now = new Date();
        const moveToPastDate = new Date(event.moveToPastDate);
        const removeDate = new Date(event.removeDate);
        return now >= moveToPastDate && now < removeDate;
      };

      const currentEvents = events.filter(isEventCurrent).sort((a, b) => 
        new Date(a.startDate) - new Date(b.startDate)
      );

      const pastEvents = events.filter(isEventPast).sort((a, b) => 
        new Date(b.moveToPastDate) - new Date(a.moveToPastDate)
      );

      const activeEvents = isPastEvents ? pastEvents : currentEvents;

      const goToNext = () => {
        setCurrentIndex((prev) => (prev + 1) % activeEvents.length);
      };

      const goToPrev = () => {
        setCurrentIndex((prev) => (prev - 1 + activeEvents.length) % activeEvents.length);
      };

      const goToSlide = (index) => {
        setCurrentIndex(index);
      };

      // Reset index when switching between current and past events
      useEffect(() => {
        setCurrentIndex(0);
      }, [isPastEvents]);

      // Reset index when events data changes or when switching views
      useEffect(() => {
        // Reset carousel index to 0 when the active events list changes
        const activeCount = isPastEvents ? pastEvents.length : currentEvents.length;
        if (currentIndex >= activeCount && activeCount > 0) {
          setCurrentIndex(0);
        }
      }, [events, isPastEvents]);

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center" style={{ background: "url('https://danpoahu.github.io/LDAH/background.png') no-repeat center center fixed", backgroundSize: 'cover' }}>
            <div style={{ backgroundColor: 'white', padding: '32px', borderRadius: '24px', textAlign: 'center' }}>
              <p className="text-[#004E7C] font-semibold">Loading events...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen p-2" style={{ background: "url('https://danpoahu.github.io/LDAH/background.png') no-repeat center center fixed", backgroundSize: 'cover' }}>
          <div className="max-w-2xl mx-auto">
            {/* Header with Logo and Menu */}
            <div className="text-center mb-4 mt-2 relative">
              {/* Hamburger Menu Icon */}
              <button 
                onClick={() => setMenuOpen(!menuOpen)}
                style={{
                  position: 'absolute',
                  top: '8px',
                  right: '8px',
                  color: '#004E7C',
                  cursor: 'pointer',
                  transition: 'opacity 0.2s',
                  display: 'inline-block',
                  background: 'none',
                  border: 'none',
                  padding: '4px'
                }}
                onMouseOver={(e) => {
                  e.currentTarget.style.opacity = '0.7';
                }}
                onMouseOut={(e) => {
                  e.currentTarget.style.opacity = '1';
                }}
              >
                {menuOpen ? <X size={22} /> : <Menu size={22} />}
              </button>

              {/* Dropdown Menu */}
              {menuOpen && (
                <div style={{
                  position: 'absolute',
                  top: '40px',
                  right: '8px',
                  backgroundColor: 'rgba(255, 255, 255, 0.98)',
                  borderRadius: '10px',
                  border: '2px solid #004E7C',
                  backdropFilter: 'blur(10px)',
                  boxShadow: '0 4px 6px rgba(0,0,0,0.1)',
                  zIndex: 1000,
                  minWidth: '140px',
                  fontSize: '13px'
                }}>
                  <a href="index.html" style={{
                    display: 'block',
                    padding: '8px 14px',
                    color: '#004E7C',
                    textDecoration: 'none',
                    fontWeight: 'bold',
                    borderBottom: '1px solid rgba(0, 78, 124, 0.1)',
                    transition: 'background 0.2s'
                  }}
                  onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(0, 78, 124, 0.1)'}
                  onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}
                  >
                    üè† Home
                  </a>
                  <a href="events.html" style={{
                    display: 'block',
                    padding: '8px 14px',
                    color: '#004E7C',
                    textDecoration: 'none',
                    fontWeight: 'bold',
                    borderBottom: '1px solid rgba(0, 78, 124, 0.1)',
                    transition: 'background 0.2s'
                  }}
                  onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(0, 78, 124, 0.1)'}
                  onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}
                  >
                    üìÖ Events
                  </a>
                  <a href="faq.html" style={{
                    display: 'block',
                    padding: '8px 14px',
                    color: '#004E7C',
                    textDecoration: 'none',
                    fontWeight: 'bold',
                    borderBottom: '1px solid rgba(0, 78, 124, 0.1)',
                    transition: 'background 0.2s'
                  }}
                  onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(0, 78, 124, 0.1)'}
                  onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}
                  >
                    ‚ùì Quick Help
                  </a>
                  <a href="volunteer.html" style={{
                    display: 'block',
                    padding: '8px 14px',
                    color: '#004E7C',
                    textDecoration: 'none',
                    fontWeight: 'bold',
                    borderBottom: '1px solid rgba(0, 78, 124, 0.1)',
                    transition: 'background 0.2s'
                  }}
                  onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(0, 78, 124, 0.1)'}
                  onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}
                  >
                    ü§ù Volunteer
                  </a>
                  <a href="contact.html" style={{
                    display: 'block',
                    padding: '8px 14px',
                    color: '#004E7C',
                    textDecoration: 'none',
                    fontWeight: 'bold',
                    transition: 'background 0.2s',
                    borderRadius: '0 0 8px 8px'
                  }}
                  onMouseOver={(e) => e.currentTarget.style.backgroundColor = 'rgba(0, 78, 124, 0.1)'}
                  onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'transparent'}
                  >
                    üìû Contact Us
                  </a>
                </div>
              )}

              <div className="mb-1 flex justify-center">
                <a href="index.html" style={{ textDecoration: 'none' }}>
                  <div style={{
                    padding: '16px',
                    display: 'inline-block',
                    cursor: 'pointer',
                    transition: 'transform 0.2s'
                  }}
                  onMouseOver={(e) => e.currentTarget.style.transform = 'scale(1.05)'}
                  onMouseOut={(e) => e.currentTarget.style.transform = 'scale(1)'}
                  >
                    <img 
                      src="https://danpoahu.github.io/LDAH/logo_transparent.png" 
                      alt="LDAH Logo"
                      style={{ width: '120px', height: '120px', display: 'block' }}
                    />
                  </div>
                </a>
              </div>
              <h1 className="text-2xl font-bold text-[#004E7C] mb-1">Events</h1>
              <p className="text-gray-600 text-sm mb-2">
                Tap any event to view full details
              </p>
            </div>

            {/* Carousel Section */}
            {(currentEvents.length > 0 || pastEvents.length > 0) && (
              <>
                {/* Toggle buttons for Current/Past Events */}
                {currentEvents.length > 0 && pastEvents.length > 0 && (
                  <div className="flex gap-2 justify-center mb-4">
                    <button
                      onClick={() => setIsPastEvents(false)}
                      style={{
                        backgroundColor: !isPastEvents ? '#004E7C' : 'white',
                        color: !isPastEvents ? 'white' : '#004E7C',
                        border: '2px solid #004E7C',
                        borderRadius: '20px',
                        padding: '8px 24px',
                        fontSize: '14px',
                        fontWeight: 'bold',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                    >
                      Current Events
                    </button>
                    <button
                      onClick={() => setIsPastEvents(true)}
                      style={{
                        backgroundColor: isPastEvents ? '#004E7C' : 'white',
                        color: isPastEvents ? 'white' : '#004E7C',
                        border: '2px solid #004E7C',
                        borderRadius: '20px',
                        padding: '8px 24px',
                        fontSize: '14px',
                        fontWeight: 'bold',
                        cursor: 'pointer',
                        transition: 'all 0.2s'
                      }}
                    >
                      Past Events
                    </button>
                  </div>
                )}

                {activeEvents.length > 0 && currentIndex < activeEvents.length && activeEvents[currentIndex] ? (
                  <div style={{ position: 'relative', marginBottom: '32px' }}>
                    {/* Carousel Container */}
                    <div style={{
                      backgroundColor: 'transparent',
                      borderRadius: '24px',
                      padding: '40px 20px 32px',
                      border: 'none',
                      position: 'relative'
                    }}>
                      {/* Left Arrow */}
                      {activeEvents.length > 1 && (
                        <button
                          onClick={goToPrev}
                          style={{
                            position: 'absolute',
                            left: '-20px',
                            top: '50%',
                            transform: 'translateY(-50%)',
                            backgroundColor: '#004E7C',
                            color: 'white',
                            border: 'none',
                            borderRadius: '50%',
                            width: '60px',
                            height: '60px',
                            fontSize: '32px',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 10,
                            boxShadow: '0 4px 12px rgba(0,0,0,0.2)',
                            transition: 'all 0.2s'
                          }}
                          onMouseOver={(e) => {
                            e.currentTarget.style.backgroundColor = '#003A5D';
                            e.currentTarget.style.transform = 'translateY(-50%) scale(1.1)';
                          }}
                          onMouseOut={(e) => {
                            e.currentTarget.style.backgroundColor = '#004E7C';
                            e.currentTarget.style.transform = 'translateY(-50%) scale(1)';
                          }}
                        >
                          ‚Äπ
                        </button>
                      )}

                      {/* Event Content */}
                      <div style={{ 
                        textAlign: 'center',
                        display: 'flex',
                        justifyContent: 'center',
                        alignItems: 'center'
                      }}>
                        {activeEvents[currentIndex].imageUrl && (
                          <div 
                            onClick={() => setSelectedEvent(activeEvents[currentIndex])}
                            style={{
                              cursor: 'pointer',
                              marginBottom: '20px',
                              display: 'flex',
                              justifyContent: 'center'
                            }}
                          >
                            <img 
                              src={activeEvents[currentIndex].imageUrl}
                              alt={activeEvents[currentIndex].title}
                              style={{
                                width: '50%',
                                height: 'auto',
                                borderRadius: '16px',
                                boxShadow: '0 4px 12px rgba(0,0,0,0.1)',
                                transition: 'transform 0.2s',
                                filter: isPastEvents ? 'grayscale(30%)' : 'none',
                                display: 'block'
                              }}
                              onMouseOver={(e) => e.currentTarget.style.transform = 'scale(1.02)'}
                              onMouseOut={(e) => e.currentTarget.style.transform = 'scale(1)'}
                            />
                          </div>
                        )}
                      </div>

                      {/* Right Arrow */}
                      {activeEvents.length > 1 && (
                        <button
                          onClick={goToNext}
                          style={{
                            position: 'absolute',
                            right: '-20px',
                            top: '50%',
                            transform: 'translateY(-50%)',
                            backgroundColor: '#004E7C',
                            color: 'white',
                            border: 'none',
                            borderRadius: '50%',
                            width: '60px',
                            height: '60px',
                            fontSize: '32px',
                            cursor: 'pointer',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 10,
                            boxShadow: '0 4px 12px rgba(0,0,0,0.2)',
                            transition: 'all 0.2s'
                          }}
                          onMouseOver={(e) => {
                            e.currentTarget.style.backgroundColor = '#003A5D';
                            e.currentTarget.style.transform = 'translateY(-50%) scale(1.1)';
                          }}
                          onMouseOut={(e) => {
                            e.currentTarget.style.backgroundColor = '#004E7C';
                            e.currentTarget.style.transform = 'translateY(-50%) scale(1)';
                          }}
                        >
                          ‚Ä∫
                        </button>
                      )}

                      {/* Dots Navigation */}
                      {activeEvents.length > 1 && (
                        <div style={{
                          display: 'flex',
                          justifyContent: 'center',
                          gap: '8px',
                          marginTop: '24px'
                        }}>
                          {activeEvents.map((_, index) => (
                            <button
                              key={index}
                              onClick={() => goToSlide(index)}
                              style={{
                                width: '12px',
                                height: '12px',
                                borderRadius: '50%',
                                border: 'none',
                                backgroundColor: index === currentIndex ? '#004E7C' : '#D1D5DB',
                                cursor: 'pointer',
                                transition: 'all 0.2s',
                                padding: 0
                              }}
                              onMouseOver={(e) => {
                                if (index !== currentIndex) {
                                  e.currentTarget.style.backgroundColor = '#9CA3AF';
                                }
                              }}
                              onMouseOut={(e) => {
                                if (index !== currentIndex) {
                                  e.currentTarget.style.backgroundColor = '#D1D5DB';
                                }
                              }}
                            />
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                ) : null}
              </>
            )}

            {/* No Events */}
            {currentEvents.length === 0 && pastEvents.length === 0 && (
              <div style={{
                backgroundColor: 'white',
                borderRadius: '24px',
                padding: '48px',
                textAlign: 'center',
                border: '2px solid #004E7C'
              }}>
                <Calendar size={48} className="text-gray-400 mx-auto mb-4" />
                <p className="text-gray-600 text-lg">No events scheduled at this time.</p>
                <p className="text-gray-500 text-sm mt-2">Check back soon for upcoming events!</p>
              </div>
            )}

            {/* Back Button */}
            <div className="mt-6 text-center pb-6">
              <a 
                href="index.html"
                className="inline-flex items-center gap-2 text-[#004E7C] font-semibold hover:opacity-70 transition-opacity"
              >
                <ChevronLeft size={20} />
                Back to Home
              </a>
            </div>
          </div>

          {/* Full-Screen Modal */}
          {selectedEvent && (
            <div 
              onClick={() => setSelectedEvent(null)}
              style={{
                position: 'fixed',
                top: 0,
                left: 0,
                width: '100%',
                height: '100%',
                backgroundColor: 'rgba(0, 0, 0, 0.95)',
                zIndex: 1000,
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                padding: '20px'
              }}
            >
              {/* Close Button */}
              <button
                onClick={() => setSelectedEvent(null)}
                style={{
                  position: 'absolute',
                  top: '20px',
                  right: '20px',
                  backgroundColor: 'rgba(255, 255, 255, 0.9)',
                  border: 'none',
                  width: '40px',
                  height: '40px',
                  borderRadius: '50%',
                  fontSize: '24px',
                  cursor: 'pointer',
                  display: 'flex',
                  alignItems: 'center',
                  justifyContent: 'center',
                  zIndex: 1001,
                  fontWeight: 'bold'
                }}
              >
                √ó
              </button>

              {/* Full-Screen Image */}
              {selectedEvent.imageUrl && (
                <img 
                  src={selectedEvent.imageUrl}
                  alt={selectedEvent.title}
                  onClick={(e) => e.stopPropagation()}
                  style={{
                    maxWidth: '100%',
                    maxHeight: '100%',
                    width: 'auto',
                    height: 'auto',
                    objectFit: 'contain',
                    borderRadius: '8px'
                  }}
                />
              )}
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<EventsApp />, document.getElementById('root'));
  </script>
</body>
</html>
