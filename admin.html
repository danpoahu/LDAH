<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>LDAH - Admin Panel</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: url('https://danpoahu.github.io/LDAH/background.png') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Icons
    const ChevronLeft = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    );

    const Plus = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Edit2 = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
      </svg>
    );

    const Trash2 = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const Save = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
        <polyline points="17 21 17 13 7 13 7 21"></polyline>
        <polyline points="7 3 7 8 15 8"></polyline>
      </svg>
    );

    const GripVertical = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="9" cy="12" r="1"></circle>
        <circle cx="9" cy="5" r="1"></circle>
        <circle cx="9" cy="19" r="1"></circle>
        <circle cx="15" cy="12" r="1"></circle>
        <circle cx="15" cy="5" r="1"></circle>
        <circle cx="15" cy="19" r="1"></circle>
      </svg>
    );

    const Folder = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
      </svg>
    );

    const Calendar = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAU3CQ07bCVKlJ1qGak-150kaJEyPKldLk",
      authDomain: "ldah-932d5.firebaseapp.com",
      projectId: "ldah-932d5",
      storageBucket: "ldah-932d5.firebasestorage.app",
      messagingSenderId: "662130454003",
      appId: "1:662130454003:web:437576d5a5811ecd8df686"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const db = firebase.firestore();
    const auth = firebase.auth();
    const storage = firebase.storage();

    auth.signInAnonymously().catch(error => {
      console.error('Anonymous auth failed:', error);
    });

    const ADMIN_PASSWORD = 'ldah2024';

    // Category Editor Component
    const CategoryEditor = ({ category, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        name: category?.name || '',
        order: category?.order || 0
      });
      const [isSaving, setIsSaving] = useState(false);

      const handleSaveClick = async () => {
        if (!formData.name.trim()) {
          alert('Category name is required');
          return;
        }

        setIsSaving(true);
        try {
          await onSave({
            ...category,
            ...formData
          });
        } finally {
          setIsSaving(false);
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style={{ backdropFilter: 'blur(4px)' }}>
          <div className="max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <form onSubmit={(e) => e.preventDefault()} style={{
              backdropFilter: 'blur(20px)',
              backgroundColor: 'rgba(255,255,255,0.4)',
              borderRadius: '24px',
              border: '1px solid rgba(255,255,255,0.3)',
              padding: '32px'
            }}>
              <h2 className="text-2xl font-bold text-[#004E7C] mb-6">
                {category?.id ? 'Edit Category' : 'New Category'}
              </h2>

              <div className="mb-6">
                <label className="block font-semibold text-gray-700 mb-2">Category Name *</label>
                <input
                  type="text"
                  value={formData.name}
                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                  className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                  placeholder="e.g., IEP Process, Parent Rights"
                  required
                />
              </div>

              <div style={{ display: 'flex', gap: '16px', marginTop: '32px' }}>
                <button
                  type="button"
                  onClick={onCancel}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: '#d1d5db',
                    color: '#374151',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onClick={handleSaveClick}
                  disabled={isSaving}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: isSaving ? '#6B7280' : '#004E7C',
                    color: 'white',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: isSaving ? 'wait' : 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px',
                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                  }}
                >
                  <Save size={20} />
                  <span>{isSaving ? 'Saving...' : 'Save Category'}</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    // FAQ Editor Component
    const FaqEditor = ({ faq, categories, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        question: faq?.question || '',
        summary: faq?.summary || '',
        steps: faq?.steps || [],
        contact: faq?.contact || '(808) 532-5364',
        categoryId: faq?.categoryId || (categories.length > 0 ? categories[0].id : ''),
        order: faq?.order || 0
      });
      const [newStep, setNewStep] = useState('');
      const [editingStepIndex, setEditingStepIndex] = useState(null);
      const [editingStepText, setEditingStepText] = useState('');
      const [isSaving, setIsSaving] = useState(false);

      const handleAddStep = () => {
        if (newStep.trim()) {
          setFormData({ ...formData, steps: [...formData.steps, newStep.trim()] });
          setNewStep('');
        }
      };

      const handleEditStep = (index) => {
        setEditingStepIndex(index);
        setEditingStepText(formData.steps[index]);
      };

      const handleSaveStep = (index) => {
        if (editingStepText.trim()) {
          const newSteps = [...formData.steps];
          newSteps[index] = editingStepText.trim();
          setFormData({ ...formData, steps: newSteps });
          setEditingStepIndex(null);
          setEditingStepText('');
        }
      };

      const handleRemoveStep = (index) => {
        setFormData({ ...formData, steps: formData.steps.filter((_, i) => i !== index) });
      };

      const handleSaveClick = async () => {
        if (!formData.question.trim()) {
          alert('Question is required');
          return;
        }
        if (!formData.categoryId) {
          alert('Please select a category');
          return;
        }

        setIsSaving(true);
        try {
          await onSave({
            ...faq,
            ...formData
          });
        } finally {
          setIsSaving(false);
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style={{ backdropFilter: 'blur(4px)' }}>
          <div className="max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <form onSubmit={(e) => e.preventDefault()} style={{
              backdropFilter: 'blur(20px)',
              backgroundColor: 'rgba(255,255,255,0.4)',
              borderRadius: '24px',
              border: '1px solid rgba(255,255,255,0.3)',
              padding: '32px'
            }}>
              <h2 className="text-2xl font-bold text-[#004E7C] mb-6">
                {faq?.id ? 'Edit FAQ' : 'New FAQ'}
              </h2>

              <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Category *</label>
                  <select
                    value={formData.categoryId}
                    onChange={(e) => setFormData({ ...formData, categoryId: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    required
                  >
                    {categories.length === 0 && (
                      <option value="">No categories available - create one first</option>
                    )}
                    {categories.map(cat => (
                      <option key={cat.id} value={cat.id}>{cat.name}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Question *</label>
                  <input
                    type="text"
                    value={formData.question}
                    onChange={(e) => setFormData({ ...formData, question: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    placeholder="Enter the question"
                    required
                  />
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Summary</label>
                  <textarea
                    value={formData.summary}
                    onChange={(e) => setFormData({ ...formData, summary: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    rows="3"
                    placeholder="Brief summary or preview"
                  />
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Action Steps</label>
                  <div className="space-y-2 mb-3">
                    {formData.steps.map((step, index) => (
                      <div key={index} className="flex items-start gap-2 bg-white p-3 rounded-lg">
                        {editingStepIndex === index ? (
                          <>
                            <input
                              type="text"
                              value={editingStepText}
                              onChange={(e) => setEditingStepText(e.target.value)}
                              className="flex-1 px-3 py-2 border border-gray-300 rounded-lg"
                              autoFocus
                            />
                            <button
                              type="button"
                              onClick={() => handleSaveStep(index)}
                              className="px-3 py-2 bg-blue-500 text-white rounded-lg text-sm"
                            >
                              Save
                            </button>
                            <button
                              type="button"
                              onClick={() => setEditingStepIndex(null)}
                              className="px-3 py-2 bg-gray-300 rounded-lg text-sm"
                            >
                              Cancel
                            </button>
                          </>
                        ) : (
                          <>
                            <span className="flex-1 text-sm">{index + 1}. {step}</span>
                            <button
                              type="button"
                              onClick={() => handleEditStep(index)}
                              className="text-blue-500 hover:text-blue-700"
                            >
                              <Edit2 size={16} />
                            </button>
                            <button
                              type="button"
                              onClick={() => handleRemoveStep(index)}
                              className="text-red-500 hover:text-red-700"
                            >
                              <Trash2 size={16} />
                            </button>
                          </>
                        )}
                      </div>
                    ))}
                  </div>
                  <div className="flex gap-2">
                    <input
                      type="text"
                      value={newStep}
                      onChange={(e) => setNewStep(e.target.value)}
                      onKeyPress={(e) => {
                        if (e.key === 'Enter') {
                          e.preventDefault();
                          handleAddStep();
                        }
                      }}
                      placeholder="Add a new step"
                      className="flex-1 px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    />
                    <button
                      type="button"
                      onClick={handleAddStep}
                      className="px-4 py-3 bg-[#004E7C] text-white rounded-xl hover:bg-[#003a5c] transition-colors"
                    >
                      <Plus size={20} />
                    </button>
                  </div>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Contact Info</label>
                  <input
                    type="text"
                    value={formData.contact}
                    onChange={(e) => setFormData({ ...formData, contact: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    placeholder="Phone, email, or contact info"
                  />
                </div>
              </div>

              <div style={{ display: 'flex', gap: '16px', marginTop: '32px' }}>
                <button
                  type="button"
                  onClick={onCancel}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: '#d1d5db',
                    color: '#374151',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onClick={handleSaveClick}
                  disabled={isSaving}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: isSaving ? '#6B7280' : '#004E7C',
                    color: 'white',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: isSaving ? 'wait' : 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px',
                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                  }}
                >
                  <Save size={20} />
                  <span>{isSaving ? 'Saving...' : 'Save FAQ'}</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    // Event Editor Component
    const EventEditor = ({ event, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        title: event?.title || '',
        description: event?.description || '',
        imageUrl: event?.imageUrl || '',
        eventDate: event?.eventDate || '',
        startDate: event?.startDate || '',
        moveToPastDate: event?.moveToPastDate || '',
        removeDate: event?.removeDate || '',
        signupDates: event?.signupDates || [],
        customQuestions: event?.customQuestions || []
      });
      const [isSaving, setIsSaving] = useState(false);
      const [uploading, setUploading] = useState(false);
      const [uploadProgress, setUploadProgress] = useState(0);
      const [newSignupDate, setNewSignupDate] = useState('');
      const [newQuestion, setNewQuestion] = useState('');

      const handleImageUpload = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // Validate file type
        const validTypes = ['image/png', 'image/jpeg', 'image/jpg', 'application/pdf'];
        if (!validTypes.includes(file.type)) {
          alert('Please upload a PNG, JPG, or PDF file');
          return;
        }

        // Validate file size (max 10MB)
        if (file.size > 10 * 1024 * 1024) {
          alert('File size must be less than 10MB');
          return;
        }

        setUploading(true);
        setUploadProgress(0);

        try {
          const storageRef = storage.ref();
          const fileRef = storageRef.child(`event-images/${Date.now()}_${file.name}`);
          const uploadTask = fileRef.put(file);

          uploadTask.on('state_changed',
            (snapshot) => {
              const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              setUploadProgress(progress);
            },
            (error) => {
              console.error('Upload error:', error);
              alert('Error uploading file: ' + error.message);
              setUploading(false);
            },
            async () => {
              const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
              setFormData({ ...formData, imageUrl: downloadURL });
              setUploading(false);
              setUploadProgress(0);
            }
          );
        } catch (error) {
          console.error('Error uploading image:', error);
          alert('Error uploading image: ' + error.message);
          setUploading(false);
        }
      };

      const addSignupDate = () => {
        if (!newSignupDate.trim()) {
          alert('Please enter a date/time');
          return;
        }
        setFormData({
          ...formData,
          signupDates: [...formData.signupDates, newSignupDate]
        });
        setNewSignupDate('');
      };

      const removeSignupDate = (index) => {
        setFormData({
          ...formData,
          signupDates: formData.signupDates.filter((_, i) => i !== index)
        });
      };

      const addCustomQuestion = () => {
        if (!newQuestion.trim()) {
          alert('Please enter a question');
          return;
        }
        setFormData({
          ...formData,
          customQuestions: [...formData.customQuestions, newQuestion]
        });
        setNewQuestion('');
      };

      const removeCustomQuestion = (index) => {
        setFormData({
          ...formData,
          customQuestions: formData.customQuestions.filter((_, i) => i !== index)
        });
      };

      const handleSaveClick = async () => {
        if (!formData.title.trim()) {
          alert('Event title is required');
          return;
        }
        if (!formData.startDate || !formData.moveToPastDate || !formData.removeDate) {
          alert('All dates are required');
          return;
        }

        setIsSaving(true);
        try {
          await onSave({
            ...event,
            ...formData
          });
        } finally {
          setIsSaving(false);
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style={{ backdropFilter: 'blur(4px)' }}>
          <div className="max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <form onSubmit={(e) => e.preventDefault()} style={{
              backdropFilter: 'blur(20px)',
              backgroundColor: 'rgba(255,255,255,0.4)',
              borderRadius: '24px',
              border: '1px solid rgba(255,255,255,0.3)',
              padding: '32px'
            }}>
              <h2 className="text-2xl font-bold text-[#004E7C] mb-6">
                {event?.id ? 'Edit Event' : 'New Event'}
              </h2>

              <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Event Title *</label>
                  <input
                    type="text"
                    value={formData.title}
                    onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    placeholder="e.g., Short Film Contest"
                    required
                  />
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Description *</label>
                  <textarea
                    value={formData.description}
                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    rows="6"
                    placeholder="Event details..."
                    required
                  />
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Event Image *</label>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                    <input
                      type="file"
                      accept="image/png,image/jpeg,image/jpg,application/pdf"
                      onChange={handleImageUpload}
                      disabled={uploading || isSaving}
                      style={{
                        padding: '12px',
                        border: '2px dashed #D1D5DB',
                        borderRadius: '12px',
                        cursor: uploading || isSaving ? 'not-allowed' : 'pointer'
                      }}
                    />
                    {uploading && (
                      <div style={{ width: '100%', backgroundColor: '#E5E7EB', borderRadius: '8px', height: '8px', overflow: 'hidden' }}>
                        <div style={{
                          width: `${uploadProgress}%`,
                          backgroundColor: '#004E7C',
                          height: '100%',
                          transition: 'width 0.3s'
                        }} />
                      </div>
                    )}
                    {formData.imageUrl && (
                      <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                        <img 
                          src={formData.imageUrl} 
                          alt="Preview" 
                          style={{
                            width: '100px',
                            height: '100px',
                            objectFit: 'cover',
                            borderRadius: '8px',
                            border: '2px solid #D1D5DB'
                          }}
                        />
                        <button
                          type="button"
                          onClick={() => setFormData({ ...formData, imageUrl: '' })}
                          disabled={uploading || isSaving}
                          style={{
                            padding: '8px 16px',
                            backgroundColor: '#EF4444',
                            color: 'white',
                            borderRadius: '8px',
                            border: 'none',
                            cursor: uploading || isSaving ? 'not-allowed' : 'pointer',
                            fontSize: '14px',
                            fontWeight: 'bold'
                          }}
                        >
                          Remove Image
                        </button>
                      </div>
                    )}
                  </div>
                  <p className="text-xs text-gray-500 mt-1">Upload PNG, JPG, or PDF (max 10MB)</p>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Signup Dates/Times</label>
                  <div style={{ display: 'flex', gap: '8px', marginBottom: '12px' }}>
                    <input
                      type="text"
                      value={newSignupDate}
                      onChange={(e) => setNewSignupDate(e.target.value)}
                      placeholder="e.g., October 11, 2025 - 2:00 p.m."
                      disabled={isSaving}
                      style={{
                        flex: 1,
                        padding: '12px',
                        border: '1px solid #D1D5DB',
                        borderRadius: '8px',
                        fontSize: '14px'
                      }}
                    />
                    <button
                      type="button"
                      onClick={addSignupDate}
                      disabled={isSaving || !newSignupDate.trim()}
                      style={{
                        padding: '12px 20px',
                        backgroundColor: isSaving || !newSignupDate.trim() ? '#9CA3AF' : '#004E7C',
                        color: 'white',
                        borderRadius: '8px',
                        border: 'none',
                        cursor: isSaving || !newSignupDate.trim() ? 'not-allowed' : 'pointer',
                        fontWeight: 'bold',
                        fontSize: '14px'
                      }}
                    >
                      Add
                    </button>
                  </div>
                  {formData.signupDates.length > 0 && (
                    <div style={{
                      border: '1px solid #D1D5DB',
                      borderRadius: '8px',
                      padding: '12px',
                      display: 'flex',
                      flexDirection: 'column',
                      gap: '8px'
                    }}>
                      {formData.signupDates.map((date, index) => (
                        <div key={index} style={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                          padding: '8px 12px',
                          backgroundColor: '#F3F4F6',
                          borderRadius: '6px'
                        }}>
                          <span style={{ fontSize: '14px', color: '#374151' }}>{date}</span>
                          <button
                            type="button"
                            onClick={() => removeSignupDate(index)}
                            disabled={isSaving}
                            style={{
                              padding: '4px 12px',
                              backgroundColor: '#EF4444',
                              color: 'white',
                              borderRadius: '6px',
                              border: 'none',
                              cursor: isSaving ? 'not-allowed' : 'pointer',
                              fontSize: '12px',
                              fontWeight: 'bold'
                            }}
                          >
                            Remove
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                  <p className="text-xs text-gray-500 mt-1">Add available dates/times for volunteers to choose from</p>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Custom Questions (Optional)</label>
                  <div style={{ display: 'flex', gap: '8px', marginBottom: '12px' }}>
                    <input
                      type="text"
                      value={newQuestion}
                      onChange={(e) => setNewQuestion(e.target.value)}
                      placeholder="e.g., Do you have experience with concessions?"
                      disabled={isSaving}
                      style={{
                        flex: 1,
                        padding: '12px',
                        border: '1px solid #D1D5DB',
                        borderRadius: '8px',
                        fontSize: '14px'
                      }}
                    />
                    <button
                      type="button"
                      onClick={addCustomQuestion}
                      disabled={isSaving || !newQuestion.trim()}
                      style={{
                        padding: '12px 20px',
                        backgroundColor: isSaving || !newQuestion.trim() ? '#9CA3AF' : '#10B981',
                        color: 'white',
                        borderRadius: '8px',
                        border: 'none',
                        cursor: isSaving || !newQuestion.trim() ? 'not-allowed' : 'pointer',
                        fontWeight: 'bold',
                        fontSize: '14px'
                      }}
                    >
                      Add
                    </button>
                  </div>
                  {formData.customQuestions.length > 0 && (
                    <div style={{
                      border: '1px solid #D1D5DB',
                      borderRadius: '8px',
                      padding: '12px',
                      display: 'flex',
                      flexDirection: 'column',
                      gap: '8px'
                    }}>
                      {formData.customQuestions.map((question, index) => (
                        <div key={index} style={{
                          display: 'flex',
                          justifyContent: 'space-between',
                          alignItems: 'center',
                          padding: '8px 12px',
                          backgroundColor: '#F0FDF4',
                          borderRadius: '6px'
                        }}>
                          <span style={{ fontSize: '14px', color: '#374151' }}>{question}</span>
                          <button
                            type="button"
                            onClick={() => removeCustomQuestion(index)}
                            disabled={isSaving}
                            style={{
                              padding: '4px 12px',
                              backgroundColor: '#EF4444',
                              color: 'white',
                              borderRadius: '6px',
                              border: 'none',
                              cursor: isSaving ? 'not-allowed' : 'pointer',
                              fontSize: '12px',
                              fontWeight: 'bold'
                            }}
                          >
                            Remove
                          </button>
                        </div>
                      ))}
                    </div>
                  )}
                  <p className="text-xs text-gray-500 mt-1">Add event-specific questions (will appear as text input fields)</p>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Event Date</label>
                  <input
                    type="date"
                    value={formData.eventDate}
                    onChange={(e) => setFormData({ ...formData, eventDate: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                  />
                  <p className="text-xs text-gray-500 mt-1">The actual date of the event</p>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Start Date (Post Online) *</label>
                  <input
                    type="date"
                    value={formData.startDate}
                    onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    required
                  />
                  <p className="text-xs text-gray-500 mt-1">When to start showing this event</p>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Move to Past Date *</label>
                  <input
                    type="date"
                    value={formData.moveToPastDate}
                    onChange={(e) => setFormData({ ...formData, moveToPastDate: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    required
                  />
                  <p className="text-xs text-gray-500 mt-1">When to move this to "Past Events"</p>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Remove Date *</label>
                  <input
                    type="date"
                    value={formData.removeDate}
                    onChange={(e) => setFormData({ ...formData, removeDate: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    required
                  />
                  <p className="text-xs text-gray-500 mt-1">When to completely remove this event</p>
                </div>
              </div>

              <div style={{ display: 'flex', gap: '16px', marginTop: '32px' }}>
                <button
                  type="button"
                  onClick={onCancel}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: '#d1d5db',
                    color: '#374151',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onClick={handleSaveClick}
                  disabled={isSaving}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: isSaving ? '#6B7280' : '#004E7C',
                    color: 'white',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: isSaving ? 'wait' : 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px',
                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                  }}
                >
                  <Save size={20} />
                  <span>{isSaving ? 'Saving...' : 'Save Event'}</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    // Opportunity Editor Component
    const OpportunityEditor = ({ opportunity, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        title: opportunity?.title || '',
        description: opportunity?.description || '',
        requirements: opportunity?.requirements || '',
        imageUrl: opportunity?.imageUrl || '',
        startDate: opportunity?.startDate || '',
        endDate: opportunity?.endDate || '',
        alwaysPost: opportunity?.alwaysPost || false,
        order: opportunity?.order || 0
      });
      const [isSaving, setIsSaving] = useState(false);
      const [uploading, setUploading] = useState(false);
      const [uploadProgress, setUploadProgress] = useState(0);

      const handleImageUpload = async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        // Check file type
        if (!file.type.startsWith('image/')) {
          alert('Please upload an image file');
          return;
        }

        // Check file size (max 5MB)
        if (file.size > 5 * 1024 * 1024) {
          alert('Image size should be less than 5MB');
          return;
        }

        setUploading(true);
        setUploadProgress(0);

        try {
          // Create a unique filename
          const timestamp = Date.now();
          const filename = `volunteer-opportunities/${timestamp}-${file.name}`;
          const storageRef = storage.ref(filename);
          
          // Upload file
          const uploadTask = storageRef.put(file);
          
          uploadTask.on('state_changed',
            (snapshot) => {
              // Progress
              const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
              setUploadProgress(progress);
            },
            (error) => {
              // Error
              console.error('Upload error:', error);
              alert('Error uploading image: ' + error.message);
              setUploading(false);
            },
            async () => {
              // Complete
              const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
              setFormData({ ...formData, imageUrl: downloadURL });
              setUploading(false);
              setUploadProgress(0);
            }
          );
        } catch (error) {
          console.error('Upload error:', error);
          alert('Error uploading image: ' + error.message);
          setUploading(false);
        }
      };

      const handleSaveClick = async () => {
        if (!formData.title.trim() || !formData.description.trim()) {
          alert('Title and description are required');
          return;
        }

        if (!formData.alwaysPost && !formData.startDate && !formData.endDate) {
          alert('Either set "Always Post" or provide at least a start date or end date');
          return;
        }

        setIsSaving(true);
        try {
          await onSave({
            ...opportunity,
            ...formData
          });
        } finally {
          setIsSaving(false);
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style={{ backdropFilter: 'blur(4px)' }}>
          <div className="max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <form onSubmit={(e) => e.preventDefault()} style={{
              backdropFilter: 'blur(20px)',
              backgroundColor: 'rgba(255,255,255,0.4)',
              borderRadius: '24px',
              border: '1px solid rgba(255,255,255,0.3)',
              padding: '32px'
            }}>
              <h2 className="text-2xl font-bold text-[#004E7C] mb-6">
                {opportunity?.id ? 'Edit Volunteer Opportunity' : 'New Volunteer Opportunity'}
              </h2>

              <div className="mb-6">
                <label className="block font-semibold text-gray-700 mb-2">Title *</label>
                <input
                  type="text"
                  value={formData.title}
                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                  className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                  placeholder="e.g., Event Assistant Needed"
                  required
                />
              </div>

              <div className="mb-6">
                <label className="block font-semibold text-gray-700 mb-2">Description *</label>
                <textarea
                  value={formData.description}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                  placeholder="Describe the volunteer opportunity..."
                  rows="4"
                  required
                />
              </div>

              <div className="mb-6">
                <label className="block font-semibold text-gray-700 mb-2">Requirements</label>
                <textarea
                  value={formData.requirements}
                  onChange={(e) => setFormData({ ...formData, requirements: e.target.value })}
                  className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                  placeholder="Any specific requirements (age, skills, etc.)"
                  rows="2"
                />
              </div>

              <div className="mb-6">
                <label className="block font-semibold text-gray-700 mb-2">Image</label>
                {formData.imageUrl && (
                  <div className="mb-3">
                    <img 
                      src={formData.imageUrl} 
                      alt="Preview" 
                      style={{
                        width: '100%',
                        maxWidth: '400px',
                        height: '200px',
                        objectFit: 'cover',
                        borderRadius: '12px',
                        border: '2px solid #E5E7EB'
                      }}
                    />
                    <button
                      type="button"
                      onClick={() => setFormData({ ...formData, imageUrl: '' })}
                      className="mt-2 text-sm text-red-600 hover:text-red-700"
                    >
                      Remove image
                    </button>
                  </div>
                )}
                {!formData.imageUrl && (
                  <>
                    <input
                      type="file"
                      accept="image/*"
                      onChange={handleImageUpload}
                      disabled={uploading}
                      className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    />
                    {uploading && (
                      <div className="mt-2">
                        <div className="w-full bg-gray-200 rounded-full h-2">
                          <div 
                            className="bg-[#004E7C] h-2 rounded-full transition-all"
                            style={{ width: `${uploadProgress}%` }}
                          ></div>
                        </div>
                        <p className="text-xs text-gray-600 mt-1">Uploading... {Math.round(uploadProgress)}%</p>
                      </div>
                    )}
                  </>
                )}
                <p className="text-xs text-gray-500 mt-1">Recommended: 800x400px (2:1 ratio), max 5MB</p>
              </div>

              <div className="mb-6 p-4 bg-blue-50 rounded-xl">
                <label className="flex items-center gap-2 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={formData.alwaysPost}
                    onChange={(e) => setFormData({ ...formData, alwaysPost: e.target.checked })}
                    className="w-5 h-5 rounded border-gray-300 text-[#004E7C] focus:ring-2 focus:ring-[#004E7C]"
                  />
                  <span className="font-semibold text-gray-700">Always Post (Ongoing Opportunity)</span>
                </label>
                <p className="text-xs text-gray-600 mt-2 ml-7">
                  Check this box if this opportunity is always available. This will override the start and end dates.
                </p>
              </div>

              {!formData.alwaysPost && (
                <>
                  <div className="mb-6">
                    <label className="block font-semibold text-gray-700 mb-2">Start Date</label>
                    <input
                      type="date"
                      value={formData.startDate}
                      onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}
                      className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    />
                    <p className="text-xs text-gray-500 mt-1">When to start showing this opportunity</p>
                  </div>

                  <div className="mb-6">
                    <label className="block font-semibold text-gray-700 mb-2">End Date</label>
                    <input
                      type="date"
                      value={formData.endDate}
                      onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}
                      className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    />
                    <p className="text-xs text-gray-500 mt-1">When to stop showing this opportunity</p>
                  </div>
                </>
              )}

              <div style={{ display: 'flex', gap: '16px', marginTop: '32px' }}>
                <button
                  type="button"
                  onClick={onCancel}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: 'white',
                    color: '#6B7280',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: '2px solid #E5E7EB',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onClick={handleSaveClick}
                  disabled={isSaving}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: isSaving ? '#6B7280' : '#004E7C',
                    color: 'white',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: isSaving ? 'wait' : 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px',
                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                  }}
                >
                  <Save size={20} />
                  <span>{isSaving ? 'Saving...' : 'Save Opportunity'}</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    // Main Admin App
    const AdminApp = () => {
      const [categories, setCategories] = useState([]);
      const [faqs, setFaqs] = useState([]);
      const [events, setEvents] = useState([]);
      const [opportunities, setOpportunities] = useState([]);
      const [applications, setApplications] = useState([]);
      const [eventSignups, setEventSignups] = useState([]);
      const [selectedEventForSignups, setSelectedEventForSignups] = useState(null);
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [password, setPassword] = useState('');
      const [editingFaq, setEditingFaq] = useState(null);
      const [editingCategory, setEditingCategory] = useState(null);
      const [editingEvent, setEditingEvent] = useState(null);
      const [editingOpportunity, setEditingOpportunity] = useState(null);
      const [loading, setLoading] = useState(true);
      const [saveStatus, setSaveStatus] = useState('');
      const [adminView, setAdminView] = useState('categories');
      const [showApplications, setShowApplications] = useState(false);
      const [expandedAppId, setExpandedAppId] = useState(null);
      const [expandedSignupId, setExpandedSignupId] = useState(null);
      const [editingNotes, setEditingNotes] = useState({});
      const [savingNotes, setSavingNotes] = useState({});
      const [draggedItem, setDraggedItem] = useState(null);
      const [dragOverItem, setDragOverItem] = useState(null);

      // Load data
      useEffect(() => {
        const loadData = async () => {
          try {
            await auth.signInAnonymously();
            
            const categoriesSnapshot = await db.collection('categories').orderBy('order').get();
            const loadedCategories = categoriesSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setCategories(loadedCategories);

            const faqsSnapshot = await db.collection('faqs').orderBy('order').get();
            const loadedFaqs = faqsSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setFaqs(loadedFaqs);

            const eventsSnapshot = await db.collection('events').get();
            const loadedEvents = eventsSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setEvents(loadedEvents);

            const opportunitiesSnapshot = await db.collection('volunteerOpportunities').orderBy('order').get();
            const loadedOpportunities = opportunitiesSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setOpportunities(loadedOpportunities);

            const applicationsSnapshot = await db.collection('volunteers').orderBy('submittedAt', 'desc').get();
            const loadedApplications = applicationsSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setApplications(loadedApplications);
            
            console.log('Loaded:', loadedCategories.length, 'categories,', loadedFaqs.length, 'FAQs,', loadedEvents.length, 'events,', loadedOpportunities.length, 'opportunities,', loadedApplications.length, 'applications');
          } catch (error) {
            console.error('Error loading data:', error);
            alert('Error loading data: ' + error.message);
          }
          setLoading(false);
        };

        loadData();
      }, []);

      // Category handlers
      const handleSaveCategory = async (category) => {
        setSaveStatus('Saving category...');
        
        try {
          if (!auth.currentUser) {
            await auth.signInAnonymously();
          }
          
          if (category.id) {
            await db.collection('categories').doc(category.id).set(category);
            setCategories(categories.map(c => c.id === category.id ? category : c));
          } else {
            const categoryToSave = {
              name: category.name,
              order: categories.length + 1
            };
            const docRef = await db.collection('categories').add(categoryToSave);
            setCategories([...categories, { id: docRef.id, ...categoryToSave }]);
          }
          
          setSaveStatus(' Category saved!');
        } catch (error) {
          console.error('Error saving category:', error);
          setSaveStatus(' Error: ' + error.message);
        }
        
        setTimeout(() => setSaveStatus(''), 3000);
        setEditingCategory(null);
      };

      const handleDeleteCategory = async (id) => {
        const faqsInCategory = faqs.filter(f => f.categoryId === id);
        if (faqsInCategory.length > 0) {
          alert(`Cannot delete category. It contains ${faqsInCategory.length} FAQ(s). Please reassign or delete those FAQs first.`);
          return;
        }

        if (confirm('Are you sure you want to delete this category?')) {
          try {
            await db.collection('categories').doc(id).delete();
            setCategories(categories.filter(c => c.id !== id));
          } catch (error) {
            console.error('Error deleting category:', error);
            alert('Error deleting category: ' + error.message);
          }
        }
      };

      // FAQ handlers
      const handleSaveFaq = async (faq) => {
        setSaveStatus('Saving FAQ...');
        
        try {
          if (!auth.currentUser) {
            await auth.signInAnonymously();
          }
          
          if (faq.id) {
            await db.collection('faqs').doc(faq.id).set(faq);
            setFaqs(faqs.map(f => f.id === faq.id ? faq : f));
          } else {
            const faqsInCategory = faqs.filter(f => f.categoryId === faq.categoryId);
            const faqToSave = {
              question: faq.question,
              summary: faq.summary,
              steps: faq.steps,
              contact: faq.contact,
              categoryId: faq.categoryId,
              order: faqsInCategory.length + 1
            };
            const docRef = await db.collection('faqs').add(faqToSave);
            setFaqs([...faqs, { id: docRef.id, ...faqToSave }]);
          }
          
          setSaveStatus(' FAQ saved!');
        } catch (error) {
          console.error('Error saving FAQ:', error);
          setSaveStatus(' Error: ' + error.message);
        }
        
        setTimeout(() => setSaveStatus(''), 3000);
        setEditingFaq(null);
      };

      const handleDeleteFaq = async (id) => {
        if (confirm('Are you sure you want to delete this FAQ?')) {
          try {
            await db.collection('faqs').doc(id).delete();
            setFaqs(faqs.filter(f => f.id !== id));
          } catch (error) {
            console.error('Error deleting FAQ:', error);
            alert('Error deleting FAQ: ' + error.message);
          }
        }
      };

      // Event handlers
      const handleSaveEvent = async (event) => {
        setSaveStatus('Saving event...');
        
        try {
          if (!auth.currentUser) {
            await auth.signInAnonymously();
          }
          
          if (event.id) {
            await db.collection('events').doc(event.id).set(event);
            setEvents(events.map(e => e.id === event.id ? event : e));
          } else {
            const eventToSave = {
              title: event.title,
              description: event.description,
              imageUrl: event.imageUrl,
              eventDate: event.eventDate,
              startDate: event.startDate,
              moveToPastDate: event.moveToPastDate,
              removeDate: event.removeDate,
              signupDates: event.signupDates || [],
              customQuestions: event.customQuestions || []
            };
            const docRef = await db.collection('events').add(eventToSave);
            setEvents([...events, { id: docRef.id, ...eventToSave }]);
          }
          
          setSaveStatus(' Event saved!');
        } catch (error) {
          console.error('Error saving event:', error);
          setSaveStatus(' Error: ' + error.message);
        }
        
        setTimeout(() => setSaveStatus(''), 3000);
        setEditingEvent(null);
      };

      const handleDeleteEvent = async (id) => {
        if (confirm('Are you sure you want to delete this event?')) {
          try {
            await db.collection('events').doc(id).delete();
            setEvents(events.filter(e => e.id !== id));
          } catch (error) {
            console.error('Error deleting event:', error);
            alert('Error deleting event: ' + error.message);
          }
        }
      };

      // Event Signup handlers
      const loadEventSignups = async (eventId) => {
        try {
          const signupsSnapshot = await db.collection('events').doc(eventId).collection('signups').orderBy('timestamp', 'desc').get();
          const loadedSignups = signupsSnapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          setEventSignups(loadedSignups);
        } catch (error) {
          console.error('Error loading event signups:', error);
          alert('Error loading signups: ' + error.message);
        }
      };

      const handleViewEventSignups = async (event) => {
        setSelectedEventForSignups(event);
        await loadEventSignups(event.id);
      };

      const handleUpdateSignupStatus = async (eventId, signupId, newStatus) => {
        try {
          await db.collection('events').doc(eventId).collection('signups').doc(signupId).update({
            status: newStatus
          });
          setEventSignups(eventSignups.map(s => 
            s.id === signupId ? { ...s, status: newStatus } : s
          ));
        } catch (error) {
          console.error('Error updating signup status:', error);
          alert('Error updating status: ' + error.message);
        }
      };

      const handleUpdateSignupNotes = async (eventId, signupId, notes) => {
        setSavingNotes(prev => ({ ...prev, [signupId]: true }));
        try {
          await db.collection('events').doc(eventId).collection('signups').doc(signupId).update({
            adminNotes: notes
          });
          setEventSignups(eventSignups.map(s => 
            s.id === signupId ? { ...s, adminNotes: notes } : s
          ));
          // Clear editing state after successful save
          setEditingNotes(prev => {
            const newState = { ...prev };
            delete newState[signupId];
            return newState;
          });
          setSavingNotes(prev => {
            const newState = { ...prev };
            delete newState[signupId];
            return newState;
          });
        } catch (error) {
          console.error('Error updating signup notes:', error);
          alert('Error updating notes: ' + error.message);
          setSavingNotes(prev => {
            const newState = { ...prev };
            delete newState[signupId];
            return newState;
          });
        }
      };

      const handleDeleteSignup = async (eventId, signupId) => {
        if (confirm('Are you sure you want to delete this signup?')) {
          try {
            await db.collection('events').doc(eventId).collection('signups').doc(signupId).delete();
            setEventSignups(eventSignups.filter(s => s.id !== signupId));
          } catch (error) {
            console.error('Error deleting signup:', error);
            alert('Error deleting signup: ' + error.message);
          }
        }
      };

      const handleExportSignups = () => {
        if (eventSignups.length === 0) {
          alert('No signups to export');
          return;
        }

        // Group signups by date (same logic as card display)
        const dateGroups = {};
        
        eventSignups.forEach(signup => {
          if (signup.selectedDates && signup.selectedDates.length > 0) {
            signup.selectedDates.forEach(date => {
              if (!dateGroups[date]) {
                dateGroups[date] = [];
              }
              dateGroups[date].push(signup);
            });
          } else {
            if (!dateGroups['No Date Selected']) {
              dateGroups['No Date Selected'] = [];
            }
            dateGroups['No Date Selected'].push(signup);
          }
        });

        // Sort dates chronologically
        const sortedDates = Object.keys(dateGroups).sort((a, b) => {
          if (a === 'No Date Selected') return 1;
          if (b === 'No Date Selected') return -1;
          return a.localeCompare(b);
        });

        // Build CSV content grouped by date
        const csvLines = [];
        
        // Add title row
        csvLines.push(`"${selectedEventForSignups?.title || 'Event'}_signups_${new Date().toISOString().split('T')[0]}"`);
        csvLines.push(''); // Blank line
        
        // Column headers
        const headers = ['DATE/TIME', 'NAME', 'EMAIL', 'PHONE', 'PREF CONTACT', 'PARTICIPATION TYPE', 'GROUP NAME', 'SIZE', 'ADDITIONAL COMMENTS', 'STATUS'];
        csvLines.push(headers.join(','));
        
        sortedDates.forEach(date => {
          // Get unique signups for this date
          const uniqueSignups = Array.from(new Set(dateGroups[date].map(s => s.id)))
            .map(id => dateGroups[date].find(s => s.id === id));
          
          // Sort by status
          const statusOrder = { 'pending': 1, 'contacted': 2, 'confirmed': 3, 'declined': 4 };
          const sortedSignups = uniqueSignups.sort((a, b) => {
            const statusA = statusOrder[a.status || 'pending'] || 999;
            const statusB = statusOrder[b.status || 'pending'] || 999;
            return statusA - statusB;
          });
          
          // Add signup rows for this date
          sortedSignups.forEach((signup, index) => {
            const row = [
              index === 0 ? date : '', // Only show date on first row of group
              signup.name || '',
              signup.email || '',
              signup.phone || '',
              signup.preferredContact || '',
              signup.participationType || '',
              signup.groupName || '',
              signup.groupSize || '',
              signup.additionalComments || 'N/A',
              signup.status || 'pending'
            ];
            // Properly escape CSV fields
            csvLines.push(row.map(cell => {
              const str = String(cell);
              // If contains comma, quote, or newline, wrap in quotes and escape quotes
              if (str.includes(',') || str.includes('"') || str.includes('\n')) {
                return `"${str.replace(/"/g, '""')}"`;
              }
              return str;
            }).join(','));
          });
        });

        const csvContent = csvLines.join('\n');

        // Create download link
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        link.setAttribute('download', `${selectedEventForSignups?.title || 'event'}_signups_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };

      // Volunteer Opportunity handlers
      const handleSaveOpportunity = async (opportunity) => {
        setSaveStatus('Saving opportunity...');
        
        try {
          if (!auth.currentUser) {
            await auth.signInAnonymously();
          }
          
          if (opportunity.id) {
            await db.collection('volunteerOpportunities').doc(opportunity.id).set(opportunity);
            setOpportunities(opportunities.map(o => o.id === opportunity.id ? opportunity : o));
          } else {
            const opportunityToSave = {
              title: opportunity.title,
              description: opportunity.description,
              requirements: opportunity.requirements || '',
              imageUrl: opportunity.imageUrl || '',
              startDate: opportunity.startDate || '',
              endDate: opportunity.endDate || '',
              alwaysPost: opportunity.alwaysPost || false,
              order: opportunity.order || opportunities.length + 1
            };
            const docRef = await db.collection('volunteerOpportunities').add(opportunityToSave);
            setOpportunities([...opportunities, { id: docRef.id, ...opportunityToSave }]);
          }
          
          setSaveStatus(' Opportunity saved!');
        } catch (error) {
          console.error('Error saving opportunity:', error);
          setSaveStatus(' Error: ' + error.message);
        }
        
        setTimeout(() => setSaveStatus(''), 3000);
        setEditingOpportunity(null);
      };

      const handleDeleteOpportunity = async (id) => {
        if (confirm('Are you sure you want to delete this volunteer opportunity?')) {
          try {
            await db.collection('volunteerOpportunities').doc(id).delete();
            setOpportunities(opportunities.filter(o => o.id !== id));
          } catch (error) {
            console.error('Error deleting opportunity:', error);
            alert('Error deleting opportunity: ' + error.message);
          }
        }
      };

      // Application handlers
      const handleMarkAsRead = async (appId) => {
        try {
          await db.collection('volunteers').doc(appId).update({ status: 'read' });
          setApplications(applications.map(app => 
            app.id === appId ? { ...app, status: 'read' } : app
          ));
        } catch (error) {
          console.error('Error marking as read:', error);
        }
      };

      const handleToggleExpand = async (appId) => {
        if (expandedAppId === appId) {
          setExpandedAppId(null);
        } else {
          setExpandedAppId(appId);
          // Mark as read when expanded
          const app = applications.find(a => a.id === appId);
          if (app && app.status === 'new') {
            await handleMarkAsRead(appId);
          }
        }
      };

      const handleDeleteApplication = async (id) => {
        if (confirm('Are you sure you want to delete this application?')) {
          try {
            await db.collection('volunteers').doc(id).delete();
            setApplications(applications.filter(a => a.id !== id));
          } catch (error) {
            console.error('Error deleting application:', error);
            alert('Error deleting application: ' + error.message);
          }
        }
      };

      const handleUpdateApplicationStatus = async (id, newStatus) => {
        try {
          await db.collection('volunteers').doc(id).update({
            status: newStatus,
            lastStatusUpdate: new Date().toISOString()
          });
          
          // Update local state
          setApplications(applications.map(app => 
            app.id === id ? { ...app, status: newStatus, lastStatusUpdate: new Date().toISOString() } : app
          ));
        } catch (error) {
          console.error('Error updating application status:', error);
          alert('Failed to update status: ' + error.message);
        }
      };

      const handleUpdateApplicationNotes = async (id, notes) => {
        try {
          await db.collection('volunteers').doc(id).update({
            adminNotes: notes,
            lastNotesUpdate: new Date().toISOString()
          });
        } catch (error) {
          console.error('Error updating application notes:', error);
          alert('Failed to update notes: ' + error.message);
        }
      };

      const unreadCount = applications.filter(app => app.status === 'new').length;
      
      // Count pending signups across all events
      const [allEventSignups, setAllEventSignups] = useState([]);
      
      useEffect(() => {
        const loadAllSignups = async () => {
          try {
            const allSignups = [];
            for (const event of events) {
              const signupsSnapshot = await db.collection('events').doc(event.id).collection('signups').where('status', '==', 'pending').get();
              allSignups.push(...signupsSnapshot.docs);
            }
            setAllEventSignups(allSignups);
          } catch (error) {
            console.error('Error loading event signups count:', error);
          }
        };
        
        if (events.length > 0) {
          loadAllSignups();
        }
      }, [events, eventSignups]); // Reload when events change or when signups are updated
      
      const pendingSignupsCount = allEventSignups.length;

      // Drag and drop for categories
      const handleCategoryDragStart = (e, index) => {
        setDraggedItem(index);
        e.dataTransfer.effectAllowed = 'move';
      };

      const handleCategoryDragOver = (e, index) => {
        e.preventDefault();
        setDragOverItem(index);
      };

      const handleCategoryDrop = async (e, dropIndex) => {
        e.preventDefault();
        
        if (draggedItem === null || draggedItem === dropIndex) {
          setDraggedItem(null);
          setDragOverItem(null);
          return;
        }

        const newCategories = [...categories];
        const draggedCategory = newCategories[draggedItem];
        newCategories.splice(draggedItem, 1);
        newCategories.splice(dropIndex, 0, draggedCategory);

        const updatedCategories = newCategories.map((cat, idx) => ({
          ...cat,
          order: idx + 1
        }));

        setCategories(updatedCategories);

        try {
          const batch = db.batch();
          updatedCategories.forEach(cat => {
            const docRef = db.collection('categories').doc(cat.id);
            batch.update(docRef, { order: cat.order });
          });
          await batch.commit();
        } catch (error) {
          console.error('Error updating category order:', error);
        }

        setDraggedItem(null);
        setDragOverItem(null);
      };

      const handleCategoryDragEnd = () => {
        setDraggedItem(null);
        setDragOverItem(null);
      };

      // Drag and drop for FAQs
      const handleFaqDragStart = (e, index) => {
        setDraggedItem(index);
        e.dataTransfer.effectAllowed = 'move';
      };

      const handleFaqDragOver = (e, index) => {
        e.preventDefault();
        setDragOverItem(index);
      };

      const handleFaqDrop = async (e, dropIndex) => {
        e.preventDefault();
        
        if (draggedItem === null || draggedItem === dropIndex) {
          setDraggedItem(null);
          setDragOverItem(null);
          return;
        }

        const newFaqs = [...faqs];
        const draggedFaq = newFaqs[draggedItem];
        newFaqs.splice(draggedItem, 1);
        newFaqs.splice(dropIndex, 0, draggedFaq);

        const updatedFaqs = newFaqs.map((faq, idx) => ({
          ...faq,
          order: idx + 1
        }));

        setFaqs(updatedFaqs);

        try {
          const batch = db.batch();
          updatedFaqs.forEach(faq => {
            const docRef = db.collection('faqs').doc(faq.id);
            batch.update(docRef, { order: faq.order });
          });
          await batch.commit();
        } catch (error) {
          console.error('Error updating FAQ order:', error);
        }

        setDraggedItem(null);
        setDragOverItem(null);
      };

      const handleFaqDragEnd = () => {
        setDraggedItem(null);
        setDragOverItem(null);
      };

      const handleLogin = (e) => {
        e.preventDefault();
        if (password === ADMIN_PASSWORD) {
          setIsAuthenticated(true);
          setPassword('');
        } else {
          alert('Incorrect password');
          setPassword('');
        }
      };

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center">
            <div style={{ backgroundColor: 'white', padding: '32px', borderRadius: '16px', textAlign: 'center' }}>
              <div className="text-[#004E7C] text-xl font-bold">Loading...</div>
            </div>
          </div>
        );
      }

      if (!isAuthenticated) {
        return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div style={{
              backdropFilter: 'blur(20px)',
              backgroundColor: 'rgba(255,255,255,0.25)',
              borderRadius: '24px',
              border: '1px solid rgba(255,255,255,0.3)',
              boxShadow: '0 8px 16px rgba(0,0,0,0.1)',
              padding: '32px',
              maxWidth: '28rem',
              width: '100%'
            }}>
              <a href="index.html" className="flex items-center gap-2 text-[#004E7C] font-semibold mb-6 hover:opacity-70 transition-opacity">
                <ChevronLeft size={20} />
                Back to Home
              </a>
              <h2 className="text-2xl font-bold text-[#004E7C] mb-6 text-center">Admin Login</h2>
              <input
                type="password"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                onKeyPress={(e) => {
                  if (e.key === 'Enter') {
                    e.preventDefault();
                    handleLogin(e);
                  }
                }}
                placeholder="Enter password"
                className="w-full px-4 py-3 rounded-xl border-2 border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#004E7C] mb-4"
                autoFocus
              />
              <button
                onClick={handleLogin}
                className="w-full bg-[#004E7C] text-white rounded-xl py-4 font-bold text-lg hover:bg-[#003a5c] transition-colors shadow-lg"
              >
                Login to Admin Panel
              </button>
            </div>
          </div>
        );
      }

      if (editingCategory !== null) {
        return <CategoryEditor category={editingCategory} onSave={handleSaveCategory} onCancel={() => setEditingCategory(null)} />;
      }

      if (editingFaq !== null) {
        return <FaqEditor faq={editingFaq} categories={categories} onSave={handleSaveFaq} onCancel={() => setEditingFaq(null)} />;
      }

      if (editingEvent !== null) {
        return <EventEditor event={editingEvent} onSave={handleSaveEvent} onCancel={() => setEditingEvent(null)} />;
      }

      if (editingOpportunity !== null) {
        return <OpportunityEditor opportunity={editingOpportunity} onSave={handleSaveOpportunity} onCancel={() => setEditingOpportunity(null)} />;
      }

      return (
        <div className="min-h-screen p-4">
          <div className="max-w-4xl mx-auto">
            <div className="mb-6">
              <a href="index.html" className="flex items-center gap-2 text-[#004E7C] font-semibold hover:opacity-70 mb-4">
                <ChevronLeft size={20} />
                Back to Home
              </a>
              <div className="flex flex-wrap gap-2 justify-center sm:justify-start">
                <button
                  onClick={() => setAdminView('categories')}
                  style={{
                    backgroundColor: adminView === 'categories' ? '#004E7C' : '#d1d5db',
                    color: adminView === 'categories' ? 'white' : '#374151',
                    padding: '10px 16px',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '14px',
                    border: 'none',
                    cursor: 'pointer'
                  }}
                >
                  Categories
                </button>
                <button
                  onClick={() => setAdminView('faqs')}
                  style={{
                    backgroundColor: adminView === 'faqs' ? '#004E7C' : '#d1d5db',
                    color: adminView === 'faqs' ? 'white' : '#374151',
                    padding: '10px 16px',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '14px',
                    border: 'none',
                    cursor: 'pointer'
                  }}
                >
                  FAQs
                </button>
                <button
                  onClick={() => setAdminView('events')}
                  style={{
                    backgroundColor: adminView === 'events' ? '#004E7C' : '#d1d5db',
                    color: adminView === 'events' ? 'white' : '#374151',
                    padding: '10px 16px',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '14px',
                    border: 'none',
                    cursor: 'pointer'
                  }}
                >
                  Events
                </button>
                <button
                  onClick={() => {
                    setAdminView('eventSignups');
                    setSelectedEventForSignups(null);
                  }}
                  style={{
                    backgroundColor: adminView === 'eventSignups' ? '#004E7C' : '#d1d5db',
                    color: adminView === 'eventSignups' ? 'white' : '#374151',
                    padding: '10px 16px',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '14px',
                    border: 'none',
                    cursor: 'pointer',
                    position: 'relative'
                  }}
                >
                  Event Signups
                  {pendingSignupsCount > 0 && (
                    <span style={{
                      position: 'absolute',
                      top: '-8px',
                      right: '-8px',
                      backgroundColor: '#ef4444',
                      color: 'white',
                      borderRadius: '12px',
                      padding: '2px 8px',
                      fontSize: '12px',
                      fontWeight: 'bold'
                    }}>
                      {pendingSignupsCount}
                    </span>
                  )}
                </button>
                <button
                  onClick={() => {
                    setAdminView('opportunities');
                    setShowApplications(false);
                  }}
                  style={{
                    backgroundColor: adminView === 'opportunities' ? '#004E7C' : '#d1d5db',
                    color: adminView === 'opportunities' ? 'white' : '#374151',
                    padding: '10px 16px',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '14px',
                    border: 'none',
                    cursor: 'pointer',
                    position: 'relative'
                  }}
                >
                  Volunteers
                  {unreadCount > 0 && (
                    <span style={{
                      position: 'absolute',
                      top: '-8px',
                      right: '-8px',
                      backgroundColor: '#ef4444',
                      color: 'white',
                      borderRadius: '12px',
                      padding: '2px 8px',
                      fontSize: '12px',
                      fontWeight: 'bold'
                    }}>
                      {unreadCount}
                    </span>
                  )}
                </button>
              </div>
            </div>

            {saveStatus && (
              <div className="mb-4 text-center">
                <span className="inline-block bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm font-semibold">
                  {saveStatus}
                </span>
              </div>
            )}

            <div style={{ minHeight: '600px' }}>
            {adminView === 'categories' ? (
              <>
                <div className="flex justify-between items-center mb-6">
                  <h1 className="text-2xl font-bold text-[#004E7C]">Manage Categories</h1>
                  <button
                    onClick={() => setEditingCategory({ name: '', order: categories.length + 1 })}
                    style={{
                      backgroundColor: '#004E7C',
                      color: 'white',
                      padding: '12px 24px',
                      borderRadius: '12px',
                      fontWeight: 'bold',
                      border: 'none',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                  >
                    <Plus size={20} />
                    <span>Add Category</span>
                  </button>
                </div>

                <div className="space-y-3">
                  {categories.sort((a, b) => a.order - b.order).map((category, index) => {
                    const faqCount = faqs.filter(f => f.categoryId === category.id).length;
                    return (
                      <div
                        key={category.id}
                        draggable
                        onDragStart={(e) => handleCategoryDragStart(e, index)}
                        onDragEnd={handleCategoryDragEnd}
                        onDragOver={(e) => handleCategoryDragOver(e, index)}
                        onDrop={(e) => handleCategoryDrop(e, index)}
                        className={`bg-white rounded-2xl border shadow-md transition-all ${
                          dragOverItem === index ? 'border-[#004E7C] border-2' : 'border-gray-200'
                        }`}
                        style={{
                          cursor: 'grab',
                          transition: 'all 0.2s ease'
                        }}
                      >
                        <div className="p-4 flex items-center gap-4">
                          <div className="flex-shrink-0 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing">
                            <GripVertical size={24} />
                          </div>
                          
                          <div className="flex-1 min-w-0">
                            <h3 className="font-bold text-lg mb-1 text-gray-900 flex items-center gap-2">
                              <Folder size={20} className="text-[#004E7C]" />
                              {category.name}
                            </h3>
                            <div className="flex items-center gap-3 text-xs text-gray-500">
                              <span className="bg-gray-100 px-2 py-1 rounded-full">
                                {faqCount} {faqCount === 1 ? 'FAQ' : 'FAQs'}
                              </span>
                              <span className="text-gray-400"></span>
                              <span>Order: {category.order}</span>
                            </div>
                          </div>
                          
                          <div className="flex gap-2 flex-shrink-0">
                            <button
                              onClick={() => setEditingCategory(category)}
                              className="p-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors shadow-sm"
                              style={{ border: 'none', cursor: 'pointer' }}
                            >
                              <Edit2 size={18} />
                            </button>
                            <button
                              onClick={() => handleDeleteCategory(category.id)}
                              className="p-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors shadow-sm"
                              style={{ border: 'none', cursor: 'pointer' }}
                            >
                              <Trash2 size={18} />
                            </button>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </>
            ) : adminView === 'faqs' ? (
              <>
                <div className="flex justify-between items-center mb-6">
                  <h1 className="text-2xl font-bold text-[#004E7C]">Manage FAQs</h1>
                  <button
                    onClick={() => setEditingFaq({
                      question: '',
                      summary: '',
                      steps: [],
                      contact: '(808) 532-5364',
                      categoryId: categories.length > 0 ? categories[0].id : '',
                      order: faqs.length + 1
                    })}
                    style={{
                      backgroundColor: '#004E7C',
                      color: 'white',
                      padding: '12px 24px',
                      borderRadius: '12px',
                      fontWeight: 'bold',
                      border: 'none',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                  >
                    <Plus size={20} />
                    <span>Add FAQ</span>
                  </button>
                </div>

                <div className="space-y-3">
                  {faqs.sort((a, b) => a.order - b.order).map((faq, index) => {
                    const category = categories.find(c => c.id === faq.categoryId);
                    return (
                      <div
                        key={faq.id}
                        draggable
                        onDragStart={(e) => handleFaqDragStart(e, index)}
                        onDragEnd={handleFaqDragEnd}
                        onDragOver={(e) => handleFaqDragOver(e, index)}
                        onDrop={(e) => handleFaqDrop(e, index)}
                        className={`bg-white rounded-2xl border shadow-md transition-all ${
                          dragOverItem === index ? 'border-[#004E7C] border-2' : 'border-gray-200'
                        }`}
                        style={{
                          cursor: 'grab',
                          transition: 'all 0.2s ease'
                        }}
                      >
                        <div className="p-4 flex items-start gap-4">
                          <div className="flex-shrink-0 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing mt-1">
                            <GripVertical size={24} />
                          </div>
                          
                          <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2 mb-2">
                              {category && (
                                <span className="bg-[#004E7C] text-white text-xs px-2 py-1 rounded-full">
                                  {category.name}
                                </span>
                              )}
                              <span className="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full">
                                Order: {faq.order}
                              </span>
                            </div>
                            <h3 className="font-bold text-base mb-1 text-gray-900">{faq.question}</h3>
                            {faq.summary && (
                              <p className="text-sm text-gray-600 mb-2">{faq.summary}</p>
                            )}
                            {faq.steps && faq.steps.length > 0 && (
                              <p className="text-xs text-gray-500">{faq.steps.length} action steps</p>
                            )}
                          </div>
                          
                          <div className="flex gap-2 flex-shrink-0">
                            <button
                              onClick={() => setEditingFaq(faq)}
                              className="p-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors shadow-sm"
                              style={{ border: 'none', cursor: 'pointer' }}
                            >
                              <Edit2 size={18} />
                            </button>
                            <button
                              onClick={() => handleDeleteFaq(faq.id)}
                              className="p-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors shadow-sm"
                              style={{ border: 'none', cursor: 'pointer' }}
                            >
                              <Trash2 size={18} />
                            </button>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </>
            ) : adminView === 'events' ? (
              <>
                <div className="flex justify-between items-center mb-6">
                  <h1 className="text-2xl font-bold text-[#004E7C]">Manage Events</h1>
                  <button
                    onClick={() => setEditingEvent({
                      title: '',
                      description: '',
                      imageUrl: '',
                      eventDate: '',
                      startDate: '',
                      moveToPastDate: '',
                      removeDate: ''
                    })}
                    style={{
                      backgroundColor: '#004E7C',
                      color: 'white',
                      padding: '12px 24px',
                      borderRadius: '12px',
                      fontWeight: 'bold',
                      border: 'none',
                      cursor: 'pointer',
                      display: 'flex',
                      alignItems: 'center',
                      gap: '8px'
                    }}
                  >
                    <Plus size={20} />
                    <span>Add Event</span>
                  </button>
                </div>

                <div className="space-y-3">
                  {events.sort((a, b) => new Date(a.startDate) - new Date(b.startDate)).map((event) => {
                    const now = new Date();
                    const startDate = new Date(event.startDate);
                    const moveToPastDate = new Date(event.moveToPastDate);
                    const removeDate = new Date(event.removeDate);
                    
                    let status = 'Scheduled';
                    let statusColor = 'bg-blue-100 text-blue-700';
                    if (now >= startDate && now < moveToPastDate) {
                      status = 'Current';
                      statusColor = 'bg-green-100 text-green-700';
                    } else if (now >= moveToPastDate && now < removeDate) {
                      status = 'Past';
                      statusColor = 'bg-gray-100 text-gray-700';
                    } else if (now >= removeDate) {
                      status = 'Expired';
                      statusColor = 'bg-red-100 text-red-700';
                    }

                    // Count pending signups for this event
                    const pendingForEvent = allEventSignups.filter(doc => {
                      const data = doc.data();
                      return doc.ref.parent.parent.id === event.id && (!data.status || data.status === 'pending');
                    }).length;

                    return (
                      <div
                        key={event.id}
                        className="bg-white rounded-2xl border border-gray-200 shadow-md"
                      >
                        <div className="p-4">
                          <div className="flex items-start gap-4">
                            {event.imageUrl && (
                              <img 
                                src={event.imageUrl}
                                alt={event.title}
                                style={{
                                  width: '100px',
                                  height: '100px',
                                  objectFit: 'cover',
                                  borderRadius: '12px'
                                }}
                              />
                            )}
                            
                            <div className="flex-1 min-w-0">
                              <div className="flex items-center gap-2 mb-2">
                                <h3 className="font-bold text-lg text-gray-900">{event.title}</h3>
                                <span className={`text-xs px-2 py-1 rounded-full ${statusColor}`}>
                                  {status}
                                </span>
                              </div>
                              <p className="text-sm text-gray-600 mb-2 line-clamp-2">{event.description}</p>
                              <div className="flex flex-wrap gap-3 text-xs text-gray-500">
                                {event.eventDate && <span> Event: {event.eventDate}</span>}
                                <span> Start: {event.startDate}</span>
                                <span> Past: {event.moveToPastDate}</span>
                                <span> Remove: {event.removeDate}</span>
                              </div>
                            </div>
                            
                            <div className="flex gap-2 flex-shrink-0">
                              <button
                                onClick={() => {
                                  setAdminView('eventSignups');
                                  handleViewEventSignups(event);
                                }}
                                className="p-3 bg-purple-500 text-white rounded-xl hover:bg-purple-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer', position: 'relative' }}
                                title="View Signups"
                              >
                                <Folder size={18} />
                                {pendingForEvent > 0 && (
                                  <span style={{
                                    position: 'absolute',
                                    top: '-6px',
                                    right: '-6px',
                                    backgroundColor: '#ef4444',
                                    color: 'white',
                                    borderRadius: '10px',
                                    padding: '2px 6px',
                                    fontSize: '11px',
                                    fontWeight: 'bold',
                                    minWidth: '20px',
                                    textAlign: 'center'
                                  }}>
                                    {pendingForEvent}
                                  </span>
                                )}
                              </button>
                              <button
                                onClick={() => setEditingEvent(event)}
                                className="p-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer' }}
                              >
                                <Edit2 size={18} />
                              </button>
                              <button
                                onClick={() => handleDeleteEvent(event.id)}
                                className="p-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer' }}
                              >
                                <Trash2 size={18} />
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </>
            ) : adminView === 'eventSignups' ? (
              <>
                {!selectedEventForSignups ? (
                  <div>
                    <h1 className="text-2xl font-bold text-[#004E7C] mb-6">Event Signups</h1>
                    <p className="text-gray-600 mb-4">Select an event from the Events tab to view its signups</p>
                    <button
                      onClick={() => setAdminView('events')}
                      style={{
                        backgroundColor: '#004E7C',
                        color: 'white',
                        padding: '12px 24px',
                        borderRadius: '12px',
                        fontWeight: 'bold',
                        border: 'none',
                        cursor: 'pointer'
                      }}
                    >
                      Go to Events
                    </button>
                  </div>
                ) : (
                  <div>
                    <div className="flex justify-between items-center mb-6">
                      <div>
                        <button
                          onClick={() => {
                            setSelectedEventForSignups(null);
                            setEventSignups([]);
                          }}
                          className="flex items-center gap-2 text-[#004E7C] font-semibold hover:opacity-70 mb-2"
                        >
                          <ChevronLeft size={20} />
                          Back to Event Selection
                        </button>
                        <h1 className="text-2xl font-bold text-[#004E7C]">
                          Signups for: {selectedEventForSignups.title}
                        </h1>
                      </div>
                      <button
                        onClick={handleExportSignups}
                        disabled={eventSignups.length === 0}
                        style={{
                          backgroundColor: eventSignups.length === 0 ? '#9CA3AF' : '#10B981',
                          color: 'white',
                          padding: '12px 24px',
                          borderRadius: '12px',
                          fontWeight: 'bold',
                          border: 'none',
                          cursor: eventSignups.length === 0 ? 'not-allowed' : 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '8px'
                        }}
                      >
                         Export CSV
                      </button>
                    </div>

                    {/* KPIs */}
                    <div className="grid grid-cols-1 sm:grid-cols-4 gap-4 mb-6">
                      <div style={{
                        backgroundColor: 'white',
                        borderRadius: '16px',
                        padding: '20px',
                        border: '2px solid #e5e7eb',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.05)'
                      }}>
                        <div className="text-3xl font-bold text-[#004E7C] mb-1">
                          {(() => {
                            // Calculate total volunteers: individuals = 1, groups = groupSize
                            return eventSignups.reduce((total, signup) => {
                              if (signup.participationType === 'Group' && signup.groupSize) {
                                return total + parseInt(signup.groupSize);
                              }
                              return total + 1; // Individual or no type = 1
                            }, 0);
                          })()}
                        </div>
                        <div className="text-sm text-gray-600 font-medium">Total Volunteers</div>
                      </div>
                      
                      <div style={{
                        backgroundColor: 'white',
                        borderRadius: '16px',
                        padding: '20px',
                        border: '2px solid #fbbf24',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.05)'
                      }}>
                        <div className="text-3xl font-bold text-[#f59e0b] mb-1">
                          {eventSignups.filter(s => s.status === 'pending').length}
                        </div>
                        <div className="text-sm text-gray-600 font-medium">Pending</div>
                      </div>
                      
                      <div style={{
                        backgroundColor: 'white',
                        borderRadius: '16px',
                        padding: '20px',
                        border: '2px solid #60a5fa',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.05)'
                      }}>
                        <div className="text-3xl font-bold text-[#3b82f6] mb-1">
                          {eventSignups.filter(s => s.status === 'contacted').length}
                        </div>
                        <div className="text-sm text-gray-600 font-medium">Contacted</div>
                      </div>
                      
                      <div style={{
                        backgroundColor: 'white',
                        borderRadius: '16px',
                        padding: '20px',
                        border: '2px solid #34d399',
                        boxShadow: '0 2px 4px rgba(0,0,0,0.05)'
                      }}>
                        <div className="text-3xl font-bold text-[#10b981] mb-1">
                          {eventSignups.filter(s => s.status === 'confirmed').length}
                        </div>
                        <div className="text-sm text-gray-600 font-medium">Confirmed</div>
                      </div>
                    </div>

                    {/* Signups Grouped by Date/Time */}
                    {eventSignups.length === 0 ? (
                      <div style={{
                        backgroundColor: 'white',
                        borderRadius: '16px',
                        padding: '48px',
                        textAlign: 'center',
                        border: '2px solid #e5e7eb'
                      }}>
                        <Calendar size={48} className="text-gray-400 mx-auto mb-4" />
                        <p className="text-gray-600 text-lg">No signups yet for this event</p>
                      </div>
                    ) : (
                      <div className="space-y-6">
                        {/* Group signups by date */}
                        {(() => {
                          // Get all unique dates from signups
                          const dateGroups = {};
                          
                          eventSignups.forEach(signup => {
                            if (signup.selectedDates && signup.selectedDates.length > 0) {
                              signup.selectedDates.forEach(date => {
                                if (!dateGroups[date]) {
                                  dateGroups[date] = [];
                                }
                                dateGroups[date].push(signup);
                              });
                            } else {
                              // If no dates selected, put in "No Date Selected" group
                              if (!dateGroups['No Date Selected']) {
                                dateGroups['No Date Selected'] = [];
                              }
                              dateGroups['No Date Selected'].push(signup);
                            }
                          });

                          // Sort dates chronologically (and put "No Date Selected" last)
                          const sortedDates = Object.keys(dateGroups).sort((a, b) => {
                            if (a === 'No Date Selected') return 1;
                            if (b === 'No Date Selected') return -1;
                            return a.localeCompare(b);
                          });

                          return sortedDates.map(date => {
                            // Get unique signups for this date (avoid duplicates)
                            const uniqueSignups = Array.from(new Set(dateGroups[date].map(s => s.id)))
                              .map(id => dateGroups[date].find(s => s.id === id));
                            
                            // Sort by status: pending, contacted, confirmed, declined
                            const statusOrder = { 'pending': 1, 'contacted': 2, 'confirmed': 3, 'declined': 4 };
                            const sortedSignups = uniqueSignups.sort((a, b) => {
                              const statusA = statusOrder[a.status || 'pending'] || 999;
                              const statusB = statusOrder[b.status || 'pending'] || 999;
                              return statusA - statusB;
                            });

                            return (
                              <div key={date} style={{
                                backgroundColor: 'rgba(255, 255, 255, 0.6)',
                                borderRadius: '20px',
                                border: '2px solid #004E7C',
                                padding: '24px',
                                backdropFilter: 'blur(10px)'
                              }}>
                                <div style={{
                                  display: 'flex',
                                  alignItems: 'center',
                                  gap: '12px',
                                  marginBottom: '20px',
                                  paddingBottom: '16px',
                                  borderBottom: '2px solid #e5e7eb'
                                }}>
                                  <Calendar size={24} className="text-[#004E7C]" />
                                  <h3 className="text-xl font-bold text-[#004E7C]">{date}</h3>
                                  <span className="px-3 py-1 bg-[#004E7C] text-white rounded-full text-sm font-bold">
                                    {(() => {
                                      // Calculate total volunteers: individuals = 1, groups = groupSize
                                      const totalVolunteers = sortedSignups.reduce((total, signup) => {
                                        if (signup.participationType === 'Group' && signup.groupSize) {
                                          return total + parseInt(signup.groupSize);
                                        }
                                        return total + 1; // Individual or no type = 1
                                      }, 0);
                                      return `${totalVolunteers} ${totalVolunteers === 1 ? 'volunteer' : 'volunteers'}`;
                                    })()}
                                  </span>
                                </div>

                                <div className="space-y-3">
                                  {sortedSignups.map((signup) => {
                                    const isExpanded = expandedSignupId === signup.id;
                                    return (
                                      <div
                                        key={signup.id}
                                        className="bg-white rounded-xl border-2 border-gray-200 shadow-sm hover:shadow-md transition-shadow"
                                      >
                                        {/* Header - Always Visible */}
                                        <div 
                                          className="p-4 cursor-pointer"
                                          onClick={() => setExpandedSignupId(isExpanded ? null : signup.id)}
                                          style={{ cursor: 'pointer' }}
                                        >
                                          <div className="flex items-start justify-between gap-4">
                                            <div className="flex-1 flex items-center gap-3">
                                              <span style={{ fontSize: '20px' }}>
                                                {isExpanded ? '' : ''}
                                              </span>
                                              <div>
                                                <h4 className="font-bold text-lg text-gray-900">{signup.name}</h4>
                                                {signup.groupName && (
                                                  <span className="text-sm text-gray-600">
                                                     {signup.groupName}
                                                    {signup.groupSize && ` (${signup.groupSize} volunteers)`}
                                                  </span>
                                                )}
                                              </div>
                                            </div>
                                            <select
                                              value={signup.status || 'pending'}
                                              onChange={(e) => {
                                                e.stopPropagation();
                                                handleUpdateSignupStatus(selectedEventForSignups.id, signup.id, e.target.value);
                                              }}
                                              onClick={(e) => e.stopPropagation()}
                                              style={{
                                                padding: '8px 12px',
                                                borderRadius: '8px',
                                                border: '2px solid #e5e7eb',
                                                fontWeight: 'bold',
                                                fontSize: '14px',
                                                cursor: 'pointer',
                                                backgroundColor: signup.status === 'confirmed' ? '#d1fae5' : 
                                                               signup.status === 'contacted' ? '#dbeafe' :
                                                               signup.status === 'declined' ? '#fee2e2' :
                                                               '#fef3c7'
                                              }}
                                            >
                                              <option value="pending"> Pending</option>
                                              <option value="contacted"> Contacted</option>
                                              <option value="confirmed"> Confirmed</option>
                                              <option value="declined"> Declined</option>
                                            </select>
                                          </div>
                                        </div>

                                        {/* Expanded Details */}
                                        {isExpanded && (
                                          <div className="px-4 pb-4 border-t-2 border-gray-100 pt-4">
                                            <div className="flex flex-wrap gap-2 text-sm text-gray-600 mb-3">
                                              <span> {signup.email}</span>
                                              <span> {signup.phone}</span>
                                            </div>

                                            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm mb-3">
                                              <div>
                                                <span className="font-semibold text-gray-700">Preferred Contact:</span>{' '}
                                                <span className="text-gray-600">{signup.preferredContact}</span>
                                              </div>
                                              <div>
                                                <span className="font-semibold text-gray-700">Type:</span>{' '}
                                                <span className="text-gray-600">{signup.participationType}</span>
                                              </div>
                                            </div>

                                            {/* Show all dates this person selected */}
                                            {signup.selectedDates && signup.selectedDates.length > 1 && (
                                              <div className="mb-3">
                                                <span className="font-semibold text-gray-700 text-sm">All Selected Dates:</span>
                                                <div className="flex flex-wrap gap-2 mt-1">
                                                  {signup.selectedDates.map((d, idx) => (
                                                    <span 
                                                      key={idx}
                                                      className="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium"
                                                    >
                                                      {d}
                                                    </span>
                                                  ))}
                                                </div>
                                              </div>
                                            )}

                                            {/* Show custom question answers */}
                                            {signup.customAnswers && Object.keys(signup.customAnswers).length > 0 && (
                                              <div className="mb-3 space-y-2">
                                                {Object.entries(signup.customAnswers).map(([question, answer], idx) => (
                                                  <div key={idx}>
                                                    <span className="font-semibold text-gray-700 text-sm">{question}:</span>
                                                    <p className="text-gray-600 text-sm mt-1">{answer}</p>
                                                  </div>
                                                ))}
                                              </div>
                                            )}

                                            {signup.additionalComments && (
                                              <div className="mb-3">
                                                <span className="font-semibold text-gray-700 text-sm">Additional Comments:</span>
                                                <p className="text-gray-600 text-sm mt-1">{signup.additionalComments}</p>
                                              </div>
                                            )}

                                            {/* Admin Notes */}
                                            <div className="mb-3">
                                              <label className="font-semibold text-gray-700 text-sm block mb-2">
                                                 Admin Notes (Private)
                                              </label>
                                              <div style={{ position: 'relative' }}>
                                                <textarea
                                                  value={editingNotes[signup.id] !== undefined ? editingNotes[signup.id] : (signup.adminNotes || '')}
                                                  onChange={(e) => {
                                                    e.stopPropagation();
                                                    setEditingNotes(prev => ({ ...prev, [signup.id]: e.target.value }));
                                                  }}
                                                  onClick={(e) => e.stopPropagation()}
                                                  placeholder="Add internal notes here..."
                                                  rows="3"
                                                  disabled={savingNotes[signup.id]}
                                                  style={{
                                                    width: '100%',
                                                    padding: '12px',
                                                    paddingBottom: '40px',
                                                    border: '2px solid #E5E7EB',
                                                    borderRadius: '8px',
                                                    fontSize: '14px',
                                                    resize: 'vertical',
                                                    fontFamily: 'inherit',
                                                    backgroundColor: '#FEF3C7',
                                                    opacity: savingNotes[signup.id] ? 0.6 : 1
                                                  }}
                                                />
                                                {editingNotes[signup.id] !== undefined && editingNotes[signup.id] !== (signup.adminNotes || '') && (
                                                  <button
                                                    onClick={(e) => {
                                                      e.stopPropagation();
                                                      handleUpdateSignupNotes(selectedEventForSignups.id, signup.id, editingNotes[signup.id]);
                                                    }}
                                                    disabled={savingNotes[signup.id]}
                                                    style={{
                                                      position: 'absolute',
                                                      bottom: '8px',
                                                      right: '8px',
                                                      padding: '6px 16px',
                                                      backgroundColor: savingNotes[signup.id] ? '#9CA3AF' : '#004E7C',
                                                      color: 'white',
                                                      border: 'none',
                                                      borderRadius: '6px',
                                                      fontSize: '12px',
                                                      fontWeight: 'bold',
                                                      cursor: savingNotes[signup.id] ? 'not-allowed' : 'pointer',
                                                      boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
                                                    }}
                                                  >
                                                    {savingNotes[signup.id] ? 'Saving...' : 'Save'}
                                                  </button>
                                                )}
                                              </div>
                                            </div>

                                            <div className="flex justify-between items-center pt-3 border-t border-gray-200">
                                              <span className="text-xs text-gray-500">
                                                Submitted: {signup.timestamp ? new Date(signup.timestamp.seconds * 1000).toLocaleString() : 'N/A'}
                                              </span>
                                              <button
                                                onClick={(e) => {
                                                  e.stopPropagation();
                                                  handleDeleteSignup(selectedEventForSignups.id, signup.id);
                                                }}
                                                className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors text-sm font-semibold"
                                                style={{ border: 'none', cursor: 'pointer' }}
                                              >
                                                Delete
                                              </button>
                                            </div>
                                          </div>
                                        )}
                                      </div>
                                    );
                                  })}
                                </div>
                              </div>
                            );
                          });
                        })()}
                      </div>
                    )}
                  </div>
                )}
              </>
            ) : adminView === 'opportunities' ? (
              <>
                <div className="mb-6">
                  <h1 className="text-2xl font-bold text-[#004E7C] mb-4">Manage Volunteer Opportunities</h1>
                  <div className="flex flex-wrap gap-3 justify-center sm:justify-start">
                    <button
                      onClick={() => setShowApplications(!showApplications)}
                      style={{
                        backgroundColor: showApplications ? '#0ea5e9' : '#6b7280',
                        color: 'white',
                        padding: '10px 16px',
                        borderRadius: '12px',
                        fontWeight: 'bold',
                        fontSize: '14px',
                        border: 'none',
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px',
                        position: 'relative'
                      }}
                    >
                      <span>{showApplications ? ' Back to Opportunities' : 'Review Applications'}</span>
                      {!showApplications && unreadCount > 0 && (
                        <span style={{
                          backgroundColor: '#ef4444',
                          color: 'white',
                          borderRadius: '12px',
                          padding: '2px 8px',
                          fontSize: '12px',
                          fontWeight: 'bold'
                        }}>
                          {unreadCount}
                        </span>
                      )}
                    </button>
                    {!showApplications && (
                      <button
                        onClick={() => setEditingOpportunity({
                          title: '',
                          description: '',
                          requirements: '',
                          startDate: '',
                          endDate: '',
                          alwaysPost: false,
                          order: opportunities.length + 1
                        })}
                        style={{
                          backgroundColor: '#004E7C',
                          color: 'white',
                          padding: '10px 16px',
                          borderRadius: '12px',
                          fontWeight: 'bold',
                          fontSize: '14px',
                          border: 'none',
                          cursor: 'pointer',
                          display: 'flex',
                          alignItems: 'center',
                          gap: '8px'
                        }}
                      >
                        <Plus size={20} />
                        <span>Add Opportunity</span>
                      </button>
                    )}
                  </div>
                </div>

                {showApplications ? (
                  <div className="space-y-3">
                    {applications.length === 0 ? (
                      <div className="text-center py-12 bg-white rounded-2xl">
                        <p className="text-gray-600">No applications yet</p>
                      </div>
                    ) : (
                      applications.sort((a, b) => {
                        // Define status priority order
                        const statusOrder = {
                          'new': 1,
                          'read': 2,
                          'contacted': 3,
                          'in-progress': 4,
                          'approved': 5,
                          'rejected': 6
                        };
                        
                        const aOrder = statusOrder[a.status] || 999;
                        const bOrder = statusOrder[b.status] || 999;
                        
                        // If same status, sort by submission date (newest first)
                        if (aOrder === bOrder) {
                          return new Date(b.submittedAt) - new Date(a.submittedAt);
                        }
                        
                        return aOrder - bOrder;
                      }).map((app) => {
                        const opportunity = opportunities.find(o => o.id === app.opportunityId);
                        const isExpanded = expandedAppId === app.id;
                        const isUnread = app.status === 'new';

                        return (
                          <div
                            key={app.id}
                            className="bg-white rounded-2xl border border-gray-200 shadow-md"
                          >
                            <div 
                              className="p-4 cursor-pointer hover:bg-gray-50"
                              onClick={() => handleToggleExpand(app.id)}
                            >
                              <div className="flex items-start justify-between gap-4">
                                <div className="flex-1">
                                  <div className="flex items-center gap-2 mb-2">
                                    <h3 className="font-bold text-lg text-gray-900">
                                      {app.firstName} {app.lastName}
                                    </h3>
                                    {(() => {
                                      const statusConfig = {
                                        'new': { label: 'New', color: 'bg-red-100 text-red-700' },
                                        'read': { label: 'Read', color: 'bg-gray-100 text-gray-700' },
                                        'contacted': { label: 'Contacted', color: 'bg-blue-100 text-blue-700' },
                                        'in-progress': { label: 'In Progress', color: 'bg-yellow-100 text-yellow-700' },
                                        'approved': { label: 'Approved', color: 'bg-green-100 text-green-700' },
                                        'rejected': { label: 'Rejected', color: 'bg-red-100 text-red-700' }
                                      };
                                      const config = statusConfig[app.status] || statusConfig['new'];
                                      return (
                                        <span className={`${config.color} text-xs px-2 py-1 rounded-full font-semibold`}>
                                          {config.label}
                                        </span>
                                      );
                                    })()}
                                  </div>
                                  <p className="text-sm text-gray-600 mb-1">
                                    <strong>Email:</strong> <a href={`mailto:${app.email}`} className="text-[#004E7C] hover:underline">{app.email}</a>
                                  </p>
                                  <p className="text-sm text-gray-600 mb-1">
                                    <strong>Opportunity:</strong> {opportunity ? opportunity.title : 'Unknown'}
                                  </p>
                                  <p className="text-xs text-gray-500">
                                    {new Date(app.submittedAt).toLocaleString()}
                                  </p>
                                </div>
                                <div className="text-gray-400">
                                  {isExpanded ? '' : ''}
                                </div>
                              </div>
                            </div>

                            {isExpanded && (
                              <div className="px-4 pb-4 border-t border-gray-200 pt-4">
                                <div className="mb-4">
                                  <h4 className="font-semibold text-gray-700 mb-2">Subject:</h4>
                                  <p className="text-gray-600">{app.subject}</p>
                                </div>

                                {app.notes && (
                                  <div className="mb-4">
                                    <h4 className="font-semibold text-gray-700 mb-2">Applicant Notes/Questions:</h4>
                                    <p className="text-gray-600 whitespace-pre-wrap">{app.notes}</p>
                                  </div>
                                )}

                                {/* Status Management */}
                                <div className="mb-4 p-3 bg-gray-50 rounded-lg">
                                  <h4 className="font-semibold text-gray-700 mb-3">Application Status</h4>
                                  <div className="flex flex-wrap gap-2 mb-3">
                                    {['new', 'read', 'contacted', 'in-progress', 'approved', 'rejected'].map(statusOption => {
                                      const statusConfig = {
                                        'new': { label: 'New', color: 'bg-red-100 text-red-700 border-red-300' },
                                        'read': { label: 'Read', color: 'bg-gray-100 text-gray-700 border-gray-300' },
                                        'contacted': { label: 'Contacted', color: 'bg-blue-100 text-blue-700 border-blue-300' },
                                        'in-progress': { label: 'In Progress', color: 'bg-yellow-100 text-yellow-700 border-yellow-300' },
                                        'approved': { label: 'Approved', color: 'bg-green-100 text-green-700 border-green-300' },
                                        'rejected': { label: 'Rejected', color: 'bg-red-100 text-red-700 border-red-300' }
                                      };
                                      const config = statusConfig[statusOption];
                                      const isActive = app.status === statusOption;
                                      
                                      return (
                                        <button
                                          key={statusOption}
                                          onClick={(e) => {
                                            e.stopPropagation();
                                            handleUpdateApplicationStatus(app.id, statusOption);
                                          }}
                                          className={`px-3 py-1 rounded-full text-xs font-semibold border-2 transition-all ${
                                            isActive ? config.color : 'bg-white text-gray-500 border-gray-200 hover:border-gray-300'
                                          }`}
                                        >
                                          {config.label}
                                        </button>
                                      );
                                    })}
                                  </div>
                                  
                                  {/* Admin Notes */}
                                  <div className="mt-3">
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">Admin Notes:</label>
                                    <textarea
                                      value={app.adminNotes || ''}
                                      onChange={(e) => {
                                        e.stopPropagation();
                                        // Update locally first for immediate feedback
                                        const updatedApps = applications.map(a => 
                                          a.id === app.id ? { ...a, adminNotes: e.target.value } : a
                                        );
                                        setApplications(updatedApps);
                                      }}
                                      onBlur={(e) => {
                                        e.stopPropagation();
                                        handleUpdateApplicationNotes(app.id, e.target.value);
                                      }}
                                      placeholder="Add internal notes about this application..."
                                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#004E7C] focus:border-transparent text-sm"
                                      rows="3"
                                      onClick={(e) => e.stopPropagation()}
                                    />
                                  </div>
                                </div>

                                <div className="flex gap-2 mt-4">
                                  <a
                                    href={`mailto:${app.email}?subject=Re: ${encodeURIComponent(app.subject)}&body=Hi ${app.firstName},%0D%0A%0D%0AThank you for your interest in volunteering with LDAH.%0D%0A%0D%0A`}
                                    className="px-4 py-2 bg-[#004E7C] text-white rounded-lg font-semibold hover:bg-[#003a5c] transition-colors"
                                  >
                                     Email {app.firstName}
                                  </a>
                                  <button
                                    onClick={(e) => {
                                      e.stopPropagation();
                                      handleDeleteApplication(app.id);
                                    }}
                                    className="px-4 py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition-colors"
                                  >
                                    Delete
                                  </button>
                                </div>
                              </div>
                            )}
                          </div>
                        );
                      })
                    )}
                  </div>
                ) : (
                  <div className="space-y-3">
                  {opportunities.sort((a, b) => a.order - b.order).map((opportunity) => {
                    const now = new Date();
                    const startDate = opportunity.startDate ? new Date(opportunity.startDate) : null;
                    const endDate = opportunity.endDate ? new Date(opportunity.endDate) : null;
                    
                    let status = 'Active';
                    let statusColor = 'bg-green-100 text-green-700';
                    
                    if (opportunity.alwaysPost) {
                      status = 'Always Posted';
                      statusColor = 'bg-blue-100 text-blue-700';
                    } else if (startDate && now < startDate) {
                      status = 'Scheduled';
                      statusColor = 'bg-yellow-100 text-yellow-700';
                    } else if (endDate && now > endDate) {
                      status = 'Expired';
                      statusColor = 'bg-red-100 text-red-700';
                    }

                    return (
                      <div
                        key={opportunity.id}
                        className="bg-white rounded-2xl border border-gray-200 shadow-md"
                      >
                        <div className="p-4">
                          <div className="flex flex-col sm:flex-row items-start gap-4">
                            {opportunity.imageUrl && (
                              <img 
                                src={opportunity.imageUrl}
                                alt={opportunity.title}
                                style={{
                                  width: '100%',
                                  maxWidth: '120px',
                                  height: '120px',
                                  objectFit: 'cover',
                                  borderRadius: '12px',
                                  flexShrink: 0
                                }}
                              />
                            )}
                            <div className="flex-1 min-w-0 w-full">
                              <div className="flex flex-wrap items-center gap-2 mb-2">
                                <h3 className="font-bold text-lg text-gray-900">{opportunity.title}</h3>
                                <span className={`text-xs px-2 py-1 rounded-full ${statusColor}`}>
                                  {status}
                                </span>
                              </div>
                              <p className="text-sm text-gray-600 mb-2">{opportunity.description}</p>
                              {opportunity.requirements && (
                                <p className="text-xs text-gray-500 mb-2"><strong>Requirements:</strong> {opportunity.requirements}</p>
                              )}
                              <div className="flex flex-wrap gap-3 text-xs text-gray-500">
                                {opportunity.alwaysPost ? (
                                  <span className="font-semibold text-blue-600"> Always Posted</span>
                                ) : (
                                  <>
                                    {opportunity.startDate && <span> Start: {opportunity.startDate}</span>}
                                    {opportunity.endDate && <span> End: {opportunity.endDate}</span>}
                                  </>
                                )}
                              </div>
                            </div>
                            
                            <div className="flex gap-2 flex-shrink-0 w-full sm:w-auto justify-end">
                              <button
                                onClick={() => setEditingOpportunity(opportunity)}
                                className="p-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer' }}
                              >
                                <Edit2 size={18} />
                              </button>
                              <button
                                onClick={() => handleDeleteOpportunity(opportunity.id)}
                                className="p-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer' }}
                              >
                                <Trash2 size={18} />
                              </button>
                            </div>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
                )}
              </>
            ) : null}
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<AdminApp />, document.getElementById('root'));
  </script>
</body>
</html>
