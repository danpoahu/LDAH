<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>LDAH - Volunteer Opportunities</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: url('https://danpoahu.github.io/LDAH/background.png') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
    }
    .volunteer-card {
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 16px;
      border: 2px solid #004E7C;
      backdrop-filter: blur(10px);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .volunteer-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    .opportunity-card {
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid rgba(0, 78, 124, 0.3);
      cursor: pointer;
      transition: all 0.2s;
    }
    .opportunity-card:hover {
      background-color: rgba(255, 255, 255, 0.3);
      border-color: #004E7C;
      transform: translateX(4px);
    }
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
    }
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal-content {
      background-color: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      border: 2px solid #004E7C;
    }
  </style>
</head>
<body>
  <div class="min-h-screen p-2">
    <div class="max-w-2xl mx-auto">
      <!-- Logo Section -->
      <div class="text-center mb-2 mt-2">
        <div class="mb-2 flex justify-center">
          <a href="index.html" style="padding: 16px; display: inline-block; cursor: pointer;">
            <img 
              src="https://danpoahu.github.io/LDAH/logo_transparent.png" 
              alt="LDAH Logo"
              style="width: 180px; height: 180px; display: block;"
            />
          </a>
        </div>
        
        <h3 class="text-lg font-bold text-[#004E7C] mb-1">
          Volunteer Opportunities
        </h3>
        <p class="text-gray-600 text-xs mb-2">
          Join our mission to empower families
        </p>
      </div>

      <!-- Back Button -->
      <div class="mb-3">
        <a href="index.html" style="
          display: inline-flex;
          align-items: center;
          gap: 8px;
          background-color: rgba(255, 255, 255, 0.1);
          border-radius: 12px;
          padding: 8px 16px;
          cursor: pointer;
          transition: transform 0.2s;
          border: 2px solid #004E7C;
          text-decoration: none;
          color: #004E7C;
          font-weight: bold;
          backdrop-filter: blur(10px);
          font-size: 14px;
        " onmouseover="this.style.transform='translateX(-2px)';" onmouseout="this.style.transform='translateX(0)';">
          <span>‚Üê</span>
          <span>Back to Home</span>
        </a>
      </div>

      <!-- Current Volunteer Opportunities Section -->
      <div class="volunteer-card">
        <h2 class="text-lg font-bold text-[#004E7C] mb-3 text-center">Volunteer Opportunities</h2>
        <div id="opportunities-container">
          <div class="text-center py-8">
            <div class="text-4xl mb-2">‚è≥</div>
            <p class="text-gray-600 text-sm">Loading opportunities...</p>
          </div>
        </div>
      </div>

      <!-- Contact Section -->
      <div class="volunteer-card">
        <h2 class="text-lg font-bold text-[#004E7C] mb-3 text-center">Get Involved</h2>
        <p class="text-gray-700 text-sm mb-3 text-center leading-relaxed">
          Interested in volunteering? Contact us to learn more about these opportunities and how you can make a difference in the lives of families with children with disabilities.
        </p>
        <div class="text-center">
          <p class="text-gray-700 text-sm mb-2">
            <strong>Phone:</strong> (808) 532-5364
          </p>
          <p class="text-gray-700 text-sm mb-2">
            <strong>Email:</strong> <a href="mailto:ldah@ldahawaii.org" class="text-[#004E7C] underline">ldah@ldahawaii.org</a>
          </p>
        </div>
      </div>

    </div>
  </div>

  <!-- Volunteer Application Modal -->
  <div id="volunteerModal" class="modal">
    <div class="modal-content">
      <h2 class="text-xl font-bold text-[#004E7C] mb-4">Apply for Volunteer Opportunity</h2>
      
      <form id="volunteerForm">
        <div class="mb-4">
          <label class="block text-sm font-semibold text-gray-700 mb-2">First Name *</label>
          <input
            type="text"
            id="firstName"
            required
            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
            placeholder="Your first name"
          />
        </div>

        <div class="mb-4">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Last Name *</label>
          <input
            type="text"
            id="lastName"
            required
            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
            placeholder="Your last name"
          />
        </div>

        <div class="mb-4">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Email Address *</label>
          <input
            type="email"
            id="email"
            required
            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
            placeholder="your.email@example.com"
          />
        </div>

        <div class="mb-4">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Subject</label>
          <input
            type="text"
            id="subject"
            readonly
            class="w-full px-4 py-2 rounded-lg border border-gray-300 bg-gray-50"
          />
        </div>

        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Notes or Questions</label>
          <textarea
            id="notes"
            rows="4"
            class="w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
            placeholder="Tell us why you're interested or ask any questions..."
          ></textarea>
        </div>

        <div class="flex gap-3">
          <button
            type="button"
            onclick="closeModal()"
            class="flex-1 px-6 py-3 bg-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-400 transition-colors"
          >
            Cancel
          </button>
          <button
            type="submit"
            id="submitBtn"
            class="flex-1 px-6 py-3 bg-[#004E7C] text-white rounded-lg font-semibold hover:bg-[#003a5c] transition-colors"
          >
            Submit Application
          </button>
        </div>
      </form>

      <div id="successMessage" style="display: none;" class="mt-4 p-4 bg-green-100 border border-green-400 rounded-lg">
        <p class="text-green-700 font-semibold">‚úì Application submitted successfully!</p>
        <p class="text-green-600 text-sm mt-1">We'll be in touch soon.</p>
      </div>
    </div>
  </div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAU3CQ07bCVKlJ1qGak-150kaJEyPKldLk",
      authDomain: "ldah-932d5.firebaseapp.com",
      projectId: "ldah-932d5",
      storageBucket: "ldah-932d5.firebasestorage.app",
      messagingSenderId: "662130454003",
      appId: "1:662130454003:web:437576d5a5811ecd8df686"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const db = firebase.firestore();
    const auth = firebase.auth();

    // Sign in anonymously
    auth.signInAnonymously().catch(error => {
      console.error('Anonymous auth failed:', error);
    });

    // Load volunteer opportunities
    async function loadOpportunities() {
      const container = document.getElementById('opportunities-container');
      const now = new Date();

      try {
        const snapshot = await db.collection('volunteerOpportunities')
          .orderBy('order')
          .get();

        if (snapshot.empty) {
          container.innerHTML = `
            <div class="text-center py-8">
              <div class="text-4xl mb-2">üìã</div>
              <p class="text-gray-600 text-sm">No specific opportunities posted at this time.</p>
              <p class="text-gray-600 text-sm mt-2">Please contact us to discuss volunteer options!</p>
            </div>
          `;
          return;
        }

        const opportunities = [];
        snapshot.forEach(doc => {
          const data = doc.data();
          const startDate = data.startDate ? new Date(data.startDate) : null;
          const endDate = data.endDate ? new Date(data.endDate) : null;

          // Show if always post is true, or if within date range
          if (data.alwaysPost || (!startDate && !endDate) || 
              (startDate && endDate && now >= startDate && now <= endDate) ||
              (startDate && !endDate && now >= startDate) ||
              (!startDate && endDate && now <= endDate)) {
            opportunities.push({ id: doc.id, ...data });
          }
        });

        if (opportunities.length === 0) {
          container.innerHTML = `
            <div class="text-center py-8">
              <div class="text-4xl mb-2">üìã</div>
              <p class="text-gray-600 text-sm">No active opportunities at this time.</p>
              <p class="text-gray-600 text-sm mt-2">Check back soon or contact us directly!</p>
            </div>
          `;
          return;
        }

        container.innerHTML = opportunities.map(opp => `
          <div class="opportunity-card" style="display: flex; gap: 16px; align-items: start;" onclick="openModal('${opp.title.replace(/'/g, "\\'")}', '${opp.id}')">
            ${opp.imageUrl ? `
              <img 
                src="${opp.imageUrl}" 
                alt="${opp.title}"
                style="width: 120px; height: 120px; object-fit: cover; border-radius: 12px; flex-shrink: 0;"
              />
            ` : ''}
            <div style="flex: 1;">
              <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                <h3 class="font-bold text-base text-[#004E7C]">${opp.title}</h3>
                ${opp.alwaysPost ? 
                  '<span class="text-xs text-green-600 font-semibold">Ongoing Opportunity</span>' : 
                  ''}
              </div>
              <p class="text-gray-700 text-sm leading-relaxed" style="margin-bottom: 8px;">${opp.description}</p>
              ${opp.requirements ? `
                <div style="margin-top: 8px;">
                  <p class="text-xs font-semibold text-gray-700" style="margin-bottom: 4px;">Requirements:</p>
                  <p class="text-xs text-gray-600">${opp.requirements}</p>
                </div>
              ` : ''}
              ${opp.startDate || opp.endDate ? `
                <div style="margin-top: 8px;" class="text-xs text-gray-600">
                  ${opp.startDate ? `<span>Start: ${new Date(opp.startDate).toLocaleDateString()}</span>` : ''}
                  ${opp.startDate && opp.endDate ? ' ‚Ä¢ ' : ''}
                  ${opp.endDate ? `<span>End: ${new Date(opp.endDate).toLocaleDateString()}</span>` : ''}
                </div>
              ` : ''}
              <p class="text-xs text-[#004E7C] font-semibold" style="margin-top: 12px;">Click to apply ‚Üí</p>
            </div>
          </div>
        `).join('');

      } catch (error) {
        console.error('Error loading opportunities:', error);
        container.innerHTML = `
          <div class="text-center py-8">
            <div class="text-4xl mb-2">‚ö†Ô∏è</div>
            <p class="text-gray-600 text-sm">Unable to load opportunities.</p>
            <p class="text-gray-600 text-sm mt-2">Please contact us directly for information.</p>
          </div>
        `;
      }
    }

    // Load opportunities when page loads
    auth.onAuthStateChanged(user => {
      if (user) {
        loadOpportunities();
      }
    });

    // Modal functions
    let currentOpportunityId = '';

    function openModal(title, opportunityId) {
      currentOpportunityId = opportunityId;
      document.getElementById('subject').value = `Volunteer - ${title}`;
      document.getElementById('volunteerModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('volunteerModal').classList.remove('active');
      document.body.style.overflow = 'auto';
      document.getElementById('volunteerForm').reset();
      document.getElementById('successMessage').style.display = 'none';
    }

    // Close modal when clicking outside
    document.getElementById('volunteerModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // Form submission
    document.getElementById('volunteerForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Submitting...';

      const formData = {
        firstName: document.getElementById('firstName').value,
        lastName: document.getElementById('lastName').value,
        email: document.getElementById('email').value,
        subject: document.getElementById('subject').value,
        notes: document.getElementById('notes').value,
        opportunityId: currentOpportunityId,
        submittedAt: new Date().toISOString(),
        status: 'new'
      };

      try {
        await db.collection('volunteers').add(formData);
        
        // Show success message
        document.getElementById('volunteerForm').style.display = 'none';
        document.getElementById('successMessage').style.display = 'block';
        
        // Close modal after 2 seconds
        setTimeout(() => {
          closeModal();
          document.getElementById('volunteerForm').style.display = 'block';
        }, 2000);
        
      } catch (error) {
        console.error('Error submitting application:', error);
        alert('Error submitting application. Please try again or contact us directly.');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Application';
      }
    });
  </script>
</body>
</html>
