<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>LDAH FAQ Helper</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%);
      min-height: 100vh;
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    @media print {
      body {
        background: white !important;
      }
      button {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide React icons as SVG components
    const ChevronLeft = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    );

    const ChevronDown = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    );

    const ChevronRight = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    );

    const Settings = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m-6-9h6m6 0h6"></path>
      </svg>
    );

    const Plus = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Edit2 = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
      </svg>
    );

    const Trash2 = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const Save = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
        <polyline points="17 21 17 13 7 13 7 21"></polyline>
        <polyline points="7 3 7 8 15 8"></polyline>
      </svg>
    );

    const Share = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
    );

    const X = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const GripVertical = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="9" cy="12" r="1"></circle>
        <circle cx="9" cy="5" r="1"></circle>
        <circle cx="9" cy="19" r="1"></circle>
        <circle cx="15" cy="12" r="1"></circle>
        <circle cx="15" cy="5" r="1"></circle>
        <circle cx="15" cy="19" r="1"></circle>
      </svg>
    );

    const Folder = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
      </svg>
    );

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAU3CQ07bCVKlJ1qGak-150kaJEyPKldLk",
      authDomain: "ldah-932d5.firebaseapp.com",
      projectId: "ldah-932d5",
      storageBucket: "ldah-932d5.firebasestorage.app",
      messagingSenderId: "662130454003",
      appId: "1:662130454003:web:437576d5a5811ecd8df686"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const db = firebase.firestore();
    const auth = firebase.auth();

    // Sign in anonymously
    auth.signInAnonymously().catch(error => {
      console.error('Anonymous auth failed:', error);
    });

    // Error boundary wrapper
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null };
      }

      static getDerivedStateFromError(error) {
        return { hasError: true, error: error };
      }

      componentDidCatch(error, errorInfo) {
        console.error('React Error:', error, errorInfo);
      }

      render() {
        if (this.state.hasError) {
          return (
            <div style={{ 
              minHeight: '100vh', 
              display: 'flex', 
              alignItems: 'center', 
              justifyContent: 'center',
              padding: '20px',
              background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)'
            }}>
              <div style={{ 
                backgroundColor: 'white', 
                padding: '32px', 
                borderRadius: '16px', 
                maxWidth: '500px',
                textAlign: 'center'
              }}>
                <h2 style={{ color: '#004E7C', fontSize: '24px', fontWeight: 'bold', marginBottom: '16px' }}>
                  Something went wrong
                </h2>
                <p style={{ color: '#666', marginBottom: '24px' }}>
                  Please refresh the page to try again.
                </p>
                <button
                  onClick={() => window.location.reload()}
                  style={{
                    backgroundColor: '#004E7C',
                    color: 'white',
                    padding: '12px 24px',
                    borderRadius: '8px',
                    border: 'none',
                    cursor: 'pointer',
                    fontWeight: '600'
                  }}
                >
                  Refresh Page
                </button>
              </div>
            </div>
          );
        }

        return this.props.children;
      }
    }

    const LDAHApp = () => {
      const [categories, setCategories] = useState([]);
      const [faqs, setFaqs] = useState([]);
      const [selected, setSelected] = useState(new Set());
      const [showAdmin, setShowAdmin] = useState(false);
      const [showGuide, setShowGuide] = useState(false);
      const [expandedCategories, setExpandedCategories] = useState(new Set());
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const unsubscribeCategories = db.collection('categories')
          .onSnapshot(snapshot => {
            const cats = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setCategories(cats);
            setLoading(false);
          }, error => {
            console.error('Error loading categories:', error);
            setLoading(false);
          });

        const unsubscribeFaqs = db.collection('faqs')
          .onSnapshot(snapshot => {
            const faqList = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            setFaqs(faqList);
          }, error => {
            console.error('Error loading FAQs:', error);
          });

        return () => {
          unsubscribeCategories();
          unsubscribeFaqs();
        };
      }, []);

      const toggleSelection = (faqId) => {
        const newSelected = new Set(selected);
        if (newSelected.has(faqId)) {
          newSelected.delete(faqId);
        } else {
          newSelected.add(faqId);
        }
        setSelected(newSelected);
      };

      const toggleCategory = (categoryId) => {
        const newExpanded = new Set(expandedCategories);
        if (newExpanded.has(categoryId)) {
          newExpanded.delete(categoryId);
        } else {
          newExpanded.add(categoryId);
        }
        setExpandedCategories(newExpanded);
      };

      // Admin Panel Component (unchanged from original)
      const AdminPanel = () => {
        const [editingCategory, setEditingCategory] = useState(null);
        const [editingFaq, setEditingFaq] = useState(null);
        const [newCategory, setNewCategory] = useState({ name: '', order: 0 });
        const [newFaq, setNewFaq] = useState({ question: '', answer: '', summary: '', categoryId: '', order: 0 });
        const [showCategoryForm, setShowCategoryForm] = useState(false);
        const [showFaqForm, setShowFaqForm] = useState(false);

        const saveCategory = async () => {
          if (!newCategory.name.trim()) return;
          try {
            if (editingCategory) {
              await db.collection('categories').doc(editingCategory.id).update(newCategory);
            } else {
              await db.collection('categories').add(newCategory);
            }
            setNewCategory({ name: '', order: 0 });
            setEditingCategory(null);
            setShowCategoryForm(false);
          } catch (error) {
            console.error('Error saving category:', error);
            alert('Error saving category. Please try again.');
          }
        };

        const deleteCategory = async (id) => {
          if (!window.confirm('Delete this category and all its questions?')) return;
          try {
            const categoryFaqs = faqs.filter(f => f.categoryId === id);
            await Promise.all(categoryFaqs.map(f => db.collection('faqs').doc(f.id).delete()));
            await db.collection('categories').doc(id).delete();
          } catch (error) {
            console.error('Error deleting category:', error);
            alert('Error deleting category. Please try again.');
          }
        };

        const saveFaq = async () => {
          if (!newFaq.question.trim() || !newFaq.answer.trim() || !newFaq.categoryId) return;
          try {
            if (editingFaq) {
              await db.collection('faqs').doc(editingFaq.id).update(newFaq);
            } else {
              await db.collection('faqs').add(newFaq);
            }
            setNewFaq({ question: '', answer: '', summary: '', categoryId: '', order: 0 });
            setEditingFaq(null);
            setShowFaqForm(false);
          } catch (error) {
            console.error('Error saving FAQ:', error);
            alert('Error saving FAQ. Please try again.');
          }
        };

        const deleteFaq = async (id) => {
          if (!window.confirm('Delete this question?')) return;
          try {
            await db.collection('faqs').doc(id).delete();
          } catch (error) {
            console.error('Error deleting FAQ:', error);
            alert('Error deleting FAQ. Please try again.');
          }
        };

        return (
          <div className="min-h-screen p-2" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
            <div className="max-w-2xl mx-auto">
              <button
                onClick={() => setShowAdmin(false)}
                className="flex items-center gap-2 text-[#004E7C] font-semibold mb-4 hover:opacity-70 transition-opacity"
              >
                <ChevronLeft size={20} />
                Back to FAQ Helper
              </button>

              <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', marginBottom: '16px' }}>
                <h2 className="text-2xl font-bold text-[#004E7C] mb-4 text-center">Admin Panel</h2>

                <div className="mb-6">
                  <div className="flex items-center justify-between mb-3">
                    <h3 className="text-lg font-bold text-gray-900">Categories</h3>
                    <button
                      onClick={() => {
                        setShowCategoryForm(!showCategoryForm);
                        setEditingCategory(null);
                        setNewCategory({ name: '', order: 0 });
                      }}
                      className="flex items-center gap-2 bg-[#004E7C] text-white px-4 py-2 rounded-lg hover:bg-[#003a5c] transition-colors"
                    >
                      <Plus size={18} />
                      Add Category
                    </button>
                  </div>

                  {showCategoryForm && (
                    <div style={{ backgroundColor: '#f8f9fa', padding: '16px', borderRadius: '12px', marginBottom: '16px' }}>
                      <input
                        type="text"
                        placeholder="Category name"
                        value={newCategory.name}
                        onChange={(e) => setNewCategory({ ...newCategory, name: e.target.value })}
                        className="w-full p-3 border border-gray-300 rounded-lg mb-2"
                      />
                      <input
                        type="number"
                        placeholder="Order"
                        value={newCategory.order}
                        onChange={(e) => setNewCategory({ ...newCategory, order: parseInt(e.target.value) || 0 })}
                        className="w-full p-3 border border-gray-300 rounded-lg mb-3"
                      />
                      <div className="flex gap-2">
                        <button
                          onClick={saveCategory}
                          className="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-semibold"
                        >
                          {editingCategory ? 'Update' : 'Save'}
                        </button>
                        <button
                          onClick={() => {
                            setShowCategoryForm(false);
                            setEditingCategory(null);
                            setNewCategory({ name: '', order: 0 });
                          }}
                          className="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  )}

                  <div className="space-y-2">
                    {categories.sort((a, b) => a.order - b.order).map(cat => (
                      <div key={cat.id} style={{ backgroundColor: '#f8f9fa', padding: '12px', borderRadius: '12px' }}>
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-2">
                            <GripVertical size={16} className="text-gray-400" />
                            <span className="font-semibold">{cat.name}</span>
                            <span className="text-sm text-gray-500">(Order: {cat.order})</span>
                          </div>
                          <div className="flex gap-2">
                            <button
                              onClick={() => {
                                setEditingCategory(cat);
                                setNewCategory({ name: cat.name, order: cat.order });
                                setShowCategoryForm(true);
                              }}
                              className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                            >
                              <Edit2 size={18} />
                            </button>
                            <button
                              onClick={() => deleteCategory(cat.id)}
                              className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                            >
                              <Trash2 size={18} />
                            </button>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                <div>
                  <div className="flex items-center justify-between mb-3">
                    <h3 className="text-lg font-bold text-gray-900">Questions</h3>
                    <button
                      onClick={() => {
                        setShowFaqForm(!showFaqForm);
                        setEditingFaq(null);
                        setNewFaq({ question: '', answer: '', summary: '', categoryId: '', order: 0 });
                      }}
                      className="flex items-center gap-2 bg-[#004E7C] text-white px-4 py-2 rounded-lg hover:bg-[#003a5c] transition-colors"
                    >
                      <Plus size={18} />
                      Add Question
                    </button>
                  </div>

                  {showFaqForm && (
                    <div style={{ backgroundColor: '#f8f9fa', padding: '16px', borderRadius: '12px', marginBottom: '16px' }}>
                      <select
                        value={newFaq.categoryId}
                        onChange={(e) => setNewFaq({ ...newFaq, categoryId: e.target.value })}
                        className="w-full p-3 border border-gray-300 rounded-lg mb-2"
                      >
                        <option value="">Select category</option>
                        {categories.sort((a, b) => a.order - b.order).map(cat => (
                          <option key={cat.id} value={cat.id}>{cat.name}</option>
                        ))}
                      </select>
                      <input
                        type="text"
                        placeholder="Question"
                        value={newFaq.question}
                        onChange={(e) => setNewFaq({ ...newFaq, question: e.target.value })}
                        className="w-full p-3 border border-gray-300 rounded-lg mb-2"
                      />
                      <textarea
                        placeholder="Short summary (optional)"
                        value={newFaq.summary}
                        onChange={(e) => setNewFaq({ ...newFaq, summary: e.target.value })}
                        className="w-full p-3 border border-gray-300 rounded-lg mb-2"
                        rows="2"
                      />
                      <textarea
                        placeholder="Full answer"
                        value={newFaq.answer}
                        onChange={(e) => setNewFaq({ ...newFaq, answer: e.target.value })}
                        className="w-full p-3 border border-gray-300 rounded-lg mb-2"
                        rows="4"
                      />
                      <input
                        type="number"
                        placeholder="Order"
                        value={newFaq.order}
                        onChange={(e) => setNewFaq({ ...newFaq, order: parseInt(e.target.value) || 0 })}
                        className="w-full p-3 border border-gray-300 rounded-lg mb-3"
                      />
                      <div className="flex gap-2">
                        <button
                          onClick={saveFaq}
                          className="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors font-semibold"
                        >
                          {editingFaq ? 'Update' : 'Save'}
                        </button>
                        <button
                          onClick={() => {
                            setShowFaqForm(false);
                            setEditingFaq(null);
                            setNewFaq({ question: '', answer: '', summary: '', categoryId: '', order: 0 });
                          }}
                          className="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors"
                        >
                          Cancel
                        </button>
                      </div>
                    </div>
                  )}

                  <div className="space-y-2">
                    {categories.sort((a, b) => a.order - b.order).map(cat => {
                      const categoryFaqs = faqs.filter(f => f.categoryId === cat.id).sort((a, b) => a.order - b.order);
                      if (categoryFaqs.length === 0) return null;
                      return (
                        <div key={cat.id}>
                          <h4 className="font-bold text-sm text-gray-700 mb-2 mt-4">{cat.name}</h4>
                          {categoryFaqs.map(faq => (
                            <div key={faq.id} style={{ backgroundColor: '#f8f9fa', padding: '12px', borderRadius: '12px', marginBottom: '8px' }}>
                              <div className="flex items-start justify-between gap-3">
                                <div className="flex-1">
                                  <div className="flex items-center gap-2 mb-1">
                                    <GripVertical size={14} className="text-gray-400" />
                                    <span className="text-sm text-gray-500">Order: {faq.order}</span>
                                  </div>
                                  <p className="font-semibold text-sm mb-1">{faq.question}</p>
                                  {faq.summary && (
                                    <p className="text-xs text-gray-600 mb-1">{faq.summary}</p>
                                  )}
                                  <p className="text-xs text-gray-500 line-clamp-2">{faq.answer}</p>
                                </div>
                                <div className="flex gap-2">
                                  <button
                                    onClick={() => {
                                      setEditingFaq(faq);
                                      setNewFaq({
                                        question: faq.question,
                                        answer: faq.answer,
                                        summary: faq.summary || '',
                                        categoryId: faq.categoryId,
                                        order: faq.order
                                      });
                                      setShowFaqForm(true);
                                    }}
                                    className="p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
                                  >
                                    <Edit2 size={16} />
                                  </button>
                                  <button
                                    onClick={() => deleteFaq(faq.id)}
                                    className="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors"
                                  >
                                    <Trash2 size={16} />
                                  </button>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      );
                    })}
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      // Action Guide Component (unchanged from original)
      const ActionGuide = () => {
        const selectedFaqs = faqs.filter(f => selected.has(f.id));
        const [editingNotes, setEditingNotes] = useState({});
        const [sortedFaqs, setSortedFaqs] = useState(selectedFaqs);

        useEffect(() => {
          setSortedFaqs(selectedFaqs);
        }, [selected]);

        const handlePrint = () => {
          window.print();
        };

        const handleShare = async () => {
          const guideText = sortedFaqs.map((faq, i) => 
            `${i + 1}. ${faq.question}\n${faq.answer}\n${editingNotes[faq.id] ? `Notes: ${editingNotes[faq.id]}` : ''}\n`
          ).join('\n');
          
          if (navigator.share) {
            try {
              await navigator.share({
                title: 'My LDAH Action Guide',
                text: guideText
              });
            } catch (error) {
              console.log('Share cancelled or failed:', error);
            }
          } else {
            navigator.clipboard.writeText(guideText);
            alert('Guide copied to clipboard!');
          }
        };

        return (
          <div className="min-h-screen p-2" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
            <div className="max-w-2xl mx-auto">
              <div className="flex items-center justify-between mb-4">
                <button
                  onClick={() => setShowGuide(false)}
                  className="flex items-center gap-2 text-[#004E7C] font-semibold hover:opacity-70 transition-opacity"
                >
                  <ChevronLeft size={20} />
                  Back to Questions
                </button>
                <div className="flex gap-2">
                  <button
                    onClick={handleShare}
                    className="flex items-center gap-2 bg-[#004E7C] text-white px-4 py-2 rounded-lg hover:bg-[#003a5c] transition-colors"
                  >
                    <Share size={18} />
                  </button>
                  <button
                    onClick={handlePrint}
                    className="flex items-center gap-2 bg-[#004E7C] text-white px-4 py-2 rounded-lg hover:bg-[#003a5c] transition-colors"
                  >
                    <Save size={18} />
                    Print
                  </button>
                </div>
              </div>

              <div style={{ backgroundColor: 'white', borderRadius: '24px', padding: '24px', marginBottom: '100px' }}>
                <div className="text-center mb-6">
                  <h1 className="text-2xl font-bold text-[#004E7C] mb-2">My Action Guide</h1>
                  <p className="text-gray-600 text-sm">
                    {sortedFaqs.length} {sortedFaqs.length === 1 ? 'question' : 'questions'} selected
                  </p>
                </div>

                <div className="space-y-4">
                  {sortedFaqs.map((faq, index) => (
                    <div key={faq.id} style={{ borderBottom: '2px solid #e5e7eb', paddingBottom: '16px' }}>
                      <div className="flex items-start gap-3 mb-3">
                        <span className="flex-shrink-0 w-8 h-8 bg-[#004E7C] text-white rounded-full flex items-center justify-center font-bold text-sm">
                          {index + 1}
                        </span>
                        <div className="flex-1">
                          <h3 className="font-bold text-lg text-gray-900 mb-2">{faq.question}</h3>
                          <p className="text-gray-700 text-sm leading-relaxed whitespace-pre-wrap mb-3">
                            {faq.answer}
                          </p>
                          <div>
                            <label className="block text-sm font-semibold text-gray-700 mb-1">My Notes:</label>
                            <textarea
                              value={editingNotes[faq.id] || ''}
                              onChange={(e) => setEditingNotes({ ...editingNotes, [faq.id]: e.target.value })}
                              placeholder="Add your personal notes here..."
                              className="w-full p-3 border border-gray-300 rounded-lg text-sm"
                              rows="3"
                            />
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>

                <div className="mt-6 pt-6 border-t-2 border-gray-200 text-center text-sm text-gray-600">
                  <p className="mb-2">
                    <strong>Learning Disabilities Association of Hawaiʻi</strong>
                  </p>
                  <p>200 North Vineyard Blvd, Suite 310, Honolulu, HI 96817</p>
                  <p>Phone: (808) 532-5364 | Toll Free: 1-800-533-9684</p>
                  <p>Email: ldah@ldahawaii.org</p>
                </div>
              </div>
            </div>
          </div>
        );
      };

      if (showAdmin) {
        return <AdminPanel />;
      }

      if (showGuide) {
        return <ActionGuide />;
      }

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
            <div style={{ backgroundColor: 'white', padding: '32px', borderRadius: '24px', textAlign: 'center' }}>
              <p className="text-[#004E7C] font-semibold">Loading...</p>
            </div>
          </div>
        );
      }

      // Main FAQ Selection View with Accordion
      return (
        <div className="min-h-screen p-2" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
          <div className="max-w-2xl mx-auto">
            {/* Logo Section */}
            <div className="text-center mb-4 mt-2">
              <div className="mb-2 flex justify-center">
                <div style={{
                  backgroundColor: 'white',
                  borderRadius: '24px',
                  padding: '16px',
                  display: 'inline-block',
                }}>
                  <img 
                    src="https://danpoahu.github.io/LDAH/logo.jpg" 
                    alt="LDAH Logo"
                    style={{ width: '120px', height: '120px', display: 'block' }}
                  />
                </div>
              </div>
              <h1 className="text-2xl font-bold text-[#004E7C] mb-1">FAQ Helper</h1>
              <p className="text-gray-600 text-sm mb-2">
                Select questions to create your personalized action guide
              </p>
            </div>

            {/* Admin button */}
            <div className="text-center mb-4">
              <button
                onClick={() => setShowAdmin(true)}
                className="text-[#004E7C] text-sm hover:underline flex items-center gap-1 mx-auto"
              >
                <Settings size={16} />
                Admin Panel
              </button>
            </div>

            {/* Categories with Accordion */}
            <div className="space-y-3 mb-6">
              {categories.length === 0 ? (
                <div style={{
                  backgroundColor: 'white',
                  borderRadius: '24px',
                  padding: '32px',
                  textAlign: 'center'
                }}>
                  <p className="text-gray-600 mb-4">No categories yet. Get started by adding some!</p>
                  <button
                    onClick={() => setShowAdmin(true)}
                    className="text-[#004E7C] font-semibold hover:opacity-70"
                  >
                    Add categories in Admin Panel →
                  </button>
                </div>
              ) : (
                categories.sort((a, b) => a.order - b.order).map(category => {
                  const categoryFaqs = faqs.filter(f => f.categoryId === category.id).sort((a, b) => a.order - b.order);
                  const isExpanded = expandedCategories.has(category.id);
                  const selectedInCategory = categoryFaqs.filter(f => selected.has(f.id)).length;

                  return (
                    <div key={category.id} style={{
                      backgroundColor: 'white',
                      borderRadius: '24px',
                      overflow: 'hidden'
                    }}>
                      {/* Category Header - Always Visible */}
                      <button
                        onClick={() => toggleCategory(category.id)}
                        style={{
                          width: '100%',
                          padding: '20px',
                          cursor: 'pointer',
                          border: 'none',
                          backgroundColor: 'white',
                          textAlign: 'left',
                          transition: 'background-color 0.2s'
                        }}
                        onMouseOver={(e) => e.currentTarget.style.backgroundColor = '#f8f9fa'}
                        onMouseOut={(e) => e.currentTarget.style.backgroundColor = 'white'}
                      >
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-3">
                            <Folder size={24} className="text-[#004E7C]" />
                            <div>
                              <h3 className="font-bold text-lg text-gray-900">{category.name}</h3>
                              <p className="text-sm text-gray-600">
                                {categoryFaqs.length} {categoryFaqs.length === 1 ? 'question' : 'questions'}
                                {selectedInCategory > 0 && (
                                  <span className="text-[#004E7C] font-semibold ml-2">
                                    • {selectedInCategory} selected
                                  </span>
                                )}
                              </p>
                            </div>
                          </div>
                          <div className="transform transition-transform" style={{
                            transform: isExpanded ? 'rotate(180deg)' : 'rotate(0deg)'
                          }}>
                            <ChevronDown size={24} className="text-[#004E7C]" />
                          </div>
                        </div>
                      </button>

                      {/* Expanded Questions */}
                      {isExpanded && (
                        <div style={{
                          borderTop: '1px solid #e5e7eb',
                          padding: '12px 20px 20px 20px'
                        }}>
                          {categoryFaqs.length === 0 ? (
                            <p className="text-gray-500 text-sm text-center py-4">
                              No questions in this category yet.
                            </p>
                          ) : (
                            <div className="space-y-2">
                              {categoryFaqs.map((faq) => {
                                const isSelected = selected.has(faq.id);
                                return (
                                  <div
                                    key={faq.id}
                                    onClick={() => toggleSelection(faq.id)}
                                    style={{
                                      backgroundColor: '#f8f9fa',
                                      borderRadius: '12px',
                                      padding: '16px',
                                      cursor: 'pointer',
                                      border: isSelected ? '2px solid #004E7C' : '2px solid transparent',
                                      transition: 'all 0.2s'
                                    }}
                                  >
                                    <div className="flex items-start gap-3">
                                      <div style={{
                                        width: '20px',
                                        height: '20px',
                                        borderRadius: '6px',
                                        border: '2px solid #004E7C',
                                        backgroundColor: isSelected ? '#004E7C' : 'white',
                                        flexShrink: 0,
                                        marginTop: '2px',
                                        display: 'flex',
                                        alignItems: 'center',
                                        justifyContent: 'center'
                                      }}>
                                        {isSelected && (
                                          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="3">
                                            <polyline points="20 6 9 17 4 12"></polyline>
                                          </svg>
                                        )}
                                      </div>
                                      <div className="flex-1">
                                        <h4 className="font-semibold text-sm mb-1 text-gray-900">{faq.question}</h4>
                                        {faq.summary && (
                                          <p className="text-xs text-gray-600 line-clamp-2">{faq.summary}</p>
                                        )}
                                      </div>
                                    </div>
                                  </div>
                                );
                              })}
                            </div>
                          )}
                        </div>
                      )}
                    </div>
                  );
                })
              )}
            </div>

            {/* Fixed Bottom Button */}
            {selected.size > 0 && (
              <div style={{
                position: 'fixed',
                bottom: 0,
                left: 0,
                right: 0,
                backgroundColor: 'white',
                padding: '16px',
                borderTop: '2px solid #e5e7eb',
                boxShadow: '0 -4px 6px rgba(0,0,0,0.1)'
              }}>
                <div className="max-w-2xl mx-auto">
                  <p className="text-center text-gray-700 mb-2 text-sm">
                    <strong>{selected.size}</strong> {selected.size === 1 ? 'question' : 'questions'} selected
                  </p>
                  <button
                    onClick={() => setShowGuide(true)}
                    className="w-full bg-[#004E7C] text-white rounded-xl py-4 font-bold text-lg hover:bg-[#003a5c] transition-colors shadow-lg"
                  >
                    Create My Action Guide →
                  </button>
                </div>
              </div>
            )}

            {/* Bottom padding to prevent content being hidden by fixed button */}
            {selected.size > 0 && <div style={{ height: '120px' }} />}
          </div>
        </div>
      );
    };

    ReactDOM.render(
      <ErrorBoundary>
        <LDAHApp />
      </ErrorBoundary>, 
      document.getElementById('root')
    );
  </script>
</body>
</html>
