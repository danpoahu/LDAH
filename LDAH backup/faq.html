<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>LDAH FAQ Helper</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%);
      min-height: 100vh;
    }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    @media print {
      body {
        background: white !important;
      }
      button {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide React icons as SVG components
    const ChevronLeft = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    );

    const ChevronRight = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    );

    const Settings = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="3"></circle>
        <path d="M12 1v6m0 6v6m-6-9h6m6 0h6"></path>
      </svg>
    );

    const Plus = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Edit2 = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
      </svg>
    );

    const Trash2 = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const Save = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
        <polyline points="17 21 17 13 7 13 7 21"></polyline>
        <polyline points="7 3 7 8 15 8"></polyline>
      </svg>
    );

    const Share = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="18" cy="5" r="3"></circle>
        <circle cx="6" cy="12" r="3"></circle>
        <circle cx="18" cy="19" r="3"></circle>
        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
      </svg>
    );

    const X = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    );

    const GripVertical = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="9" cy="12" r="1"></circle>
        <circle cx="9" cy="5" r="1"></circle>
        <circle cx="9" cy="19" r="1"></circle>
        <circle cx="15" cy="12" r="1"></circle>
        <circle cx="15" cy="5" r="1"></circle>
        <circle cx="15" cy="19" r="1"></circle>
      </svg>
    );

    const Folder = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
      </svg>
    );

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAU3CQ07bCVKlJ1qGak-150kaJEyPKldLk",
      authDomain: "ldah-932d5.firebaseapp.com",
      projectId: "ldah-932d5",
      storageBucket: "ldah-932d5.firebasestorage.app",
      messagingSenderId: "662130454003",
      appId: "1:662130454003:web:437576d5a5811ecd8df686"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const db = firebase.firestore();
    const auth = firebase.auth();

    // Sign in anonymously
    auth.signInAnonymously().catch(error => {
      console.error('Anonymous auth failed:', error);
    });

    // Error boundary wrapper
    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null };
      }

      static getDerivedStateFromError(error) {
        return { hasError: true, error: error };
      }

      componentDidCatch(error, errorInfo) {
        console.error('React Error:', error, errorInfo);
      }

      render() {
        if (this.state.hasError) {
          return (
            <div style={{ 
              minHeight: '100vh', 
              display: 'flex', 
              alignItems: 'center', 
              justifyContent: 'center',
              padding: '20px',
              background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)'
            }}>
              <div style={{ 
                backgroundColor: 'white', 
                padding: '32px', 
                borderRadius: '16px', 
                maxWidth: '500px',
                textAlign: 'center'
              }}>
                <h2 style={{ color: '#004E7C', fontSize: '24px', fontWeight: 'bold', marginBottom: '16px' }}>
                  Something went wrong
                </h2>
                <p style={{ color: '#666', marginBottom: '16px' }}>
                  {this.state.error?.toString()}
                </p>
                <button
                  onClick={() => window.location.reload()}
                  style={{
                    backgroundColor: '#004E7C',
                    color: 'white',
                    padding: '12px 24px',
                    borderRadius: '8px',
                    border: 'none',
                    cursor: 'pointer',
                    fontWeight: 'bold'
                  }}
                >
                  Reload Page
                </button>
              </div>
            </div>
          );
        }

        return this.props.children;
      }
    }

    // Category Editor Component
    const CategoryEditor = ({ category, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        name: category?.name || '',
        order: category?.order || 0
      });
      const [isSaving, setIsSaving] = useState(false);

      const handleSaveClick = async () => {
        if (!formData.name.trim()) {
          alert('Category name is required');
          return;
        }

        setIsSaving(true);
        try {
          await onSave({
            ...category,
            ...formData
          });
        } finally {
          setIsSaving(false);
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style={{ backdropFilter: 'blur(4px)' }}>
          <div className="max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <form onSubmit={(e) => e.preventDefault()} style={{
              backdropFilter: 'blur(20px)',
              backgroundColor: 'rgba(255,255,255,0.4)',
              borderRadius: '24px',
              border: '1px solid rgba(255,255,255,0.3)',
              padding: '32px'
            }}>
              <h2 className="text-2xl font-bold text-[#004E7C] mb-6">
                {category?.id ? 'Edit Category' : 'New Category'}
              </h2>

              <div className="mb-6">
                <label className="block font-semibold text-gray-700 mb-2">Category Name *</label>
                <input
                  type="text"
                  value={formData.name}
                  onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                  className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                  placeholder="e.g., IEP Process, Parent Rights"
                  required
                />
              </div>

              <div style={{ display: 'flex', gap: '16px', marginTop: '32px' }}>
                <button
                  type="button"
                  onClick={onCancel}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: '#d1d5db',
                    color: '#374151',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onClick={handleSaveClick}
                  disabled={isSaving}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: isSaving ? '#6B7280' : '#004E7C',
                    color: 'white',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: isSaving ? 'wait' : 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px',
                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                  }}
                >
                  <Save size={20} />
                  <span>{isSaving ? 'Saving...' : 'Save Category'}</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    // FAQ Editor Component
    const FaqEditor = ({ faq, categories, onSave, onCancel }) => {
      const [formData, setFormData] = useState({
        question: faq?.question || '',
        summary: faq?.summary || '',
        steps: faq?.steps || [],
        contact: faq?.contact || '(808) 532-5364',
        categoryId: faq?.categoryId || (categories.length > 0 ? categories[0].id : ''),
        order: faq?.order || 0
      });
      const [newStep, setNewStep] = useState('');
      const [editingStepIndex, setEditingStepIndex] = useState(null);
      const [editingStepText, setEditingStepText] = useState('');
      const [isSaving, setIsSaving] = useState(false);

      const handleAddStep = () => {
        if (newStep.trim()) {
          setFormData({ ...formData, steps: [...formData.steps, newStep.trim()] });
          setNewStep('');
        }
      };

      const handleEditStep = (index) => {
        setEditingStepIndex(index);
        setEditingStepText(formData.steps[index]);
      };

      const handleSaveStep = (index) => {
        if (editingStepText.trim()) {
          const newSteps = [...formData.steps];
          newSteps[index] = editingStepText.trim();
          setFormData({ ...formData, steps: newSteps });
          setEditingStepIndex(null);
          setEditingStepText('');
        }
      };

      const handleRemoveStep = (index) => {
        setFormData({ ...formData, steps: formData.steps.filter((_, i) => i !== index) });
      };

      const handleSaveClick = async () => {
        if (!formData.question.trim()) {
          alert('Question is required');
          return;
        }
        if (!formData.categoryId) {
          alert('Please select a category');
          return;
        }

        setIsSaving(true);
        try {
          await onSave({
            ...faq,
            ...formData
          });
        } finally {
          setIsSaving(false);
        }
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50" style={{ backdropFilter: 'blur(4px)' }}>
          <div className="max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <form onSubmit={(e) => e.preventDefault()} style={{
              backdropFilter: 'blur(20px)',
              backgroundColor: 'rgba(255,255,255,0.4)',
              borderRadius: '24px',
              border: '1px solid rgba(255,255,255,0.3)',
              padding: '32px'
            }}>
              <h2 className="text-2xl font-bold text-[#004E7C] mb-6">
                {faq?.id ? 'Edit FAQ' : 'New FAQ'}
              </h2>

              <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>
                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Category *</label>
                  <select
                    value={formData.categoryId}
                    onChange={(e) => setFormData({ ...formData, categoryId: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    required
                  >
                    {categories.length === 0 && (
                      <option value="">No categories available - create one first</option>
                    )}
                    {categories.map(cat => (
                      <option key={cat.id} value={cat.id}>{cat.name}</option>
                    ))}
                  </select>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Question *</label>
                  <input
                    type="text"
                    value={formData.question}
                    onChange={(e) => setFormData({ ...formData, question: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    required
                  />
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Summary</label>
                  <textarea
                    value={formData.summary}
                    onChange={(e) => setFormData({ ...formData, summary: e.target.value })}
                    rows={3}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                  />
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Steps</label>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '12px' }}>
                    {formData.steps.map((step, idx) => (
                      <div key={idx} style={{ display: 'flex', gap: '8px', alignItems: 'flex-start' }}>
                        <span className="font-bold text-[#004E7C] mt-3" style={{ minWidth: '24px' }}>{idx + 1}.</span>
                        {editingStepIndex === idx ? (
                          <>
                            <input
                              type="text"
                              value={editingStepText}
                              onChange={(e) => setEditingStepText(e.target.value)}
                              onKeyPress={(e) => e.key === 'Enter' && handleSaveStep(idx)}
                              className="flex-1 px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                              autoFocus
                            />
                            <button
                              type="button"
                              onClick={() => handleSaveStep(idx)}
                              className="p-3 bg-green-500 text-white hover:bg-green-600 rounded-lg transition-colors"
                              style={{ border: 'none', cursor: 'pointer' }}
                            >
                              <Save size={16} />
                            </button>
                            <button
                              type="button"
                              onClick={() => {
                                setEditingStepIndex(null);
                                setEditingStepText('');
                              }}
                              className="p-3 bg-gray-400 text-white hover:bg-gray-500 rounded-lg transition-colors"
                              style={{ border: 'none', cursor: 'pointer' }}
                            >
                              <X size={16} />
                            </button>
                          </>
                        ) : (
                          <>
                            <div className="flex-1 px-4 py-3 rounded-xl border border-gray-300 bg-white">
                              {step}
                            </div>
                            <button
                              type="button"
                              onClick={() => handleEditStep(idx)}
                              className="p-3 text-blue-500 hover:bg-blue-50 rounded-lg transition-colors"
                              style={{ border: 'none', cursor: 'pointer' }}
                            >
                              <Edit2 size={16} />
                            </button>
                            <button
                              type="button"
                              onClick={() => handleRemoveStep(idx)}
                              className="p-3 text-red-500 hover:bg-red-50 rounded-lg transition-colors"
                              style={{ border: 'none', cursor: 'pointer' }}
                            >
                              <Trash2 size={16} />
                            </button>
                          </>
                        )}
                      </div>
                    ))}
                  </div>
                  <div style={{ display: 'flex', gap: '8px' }}>
                    <input
                      type="text"
                      value={newStep}
                      onChange={(e) => setNewStep(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddStep())}
                      placeholder="Add a new step..."
                      className="flex-1 px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                    />
                    <button
                      type="button"
                      onClick={handleAddStep}
                      className="px-6 py-3 bg-[#004E7C] text-white rounded-xl font-semibold hover:bg-[#003a5c] transition-colors"
                      style={{ border: 'none', cursor: 'pointer' }}
                    >
                      Add
                    </button>
                  </div>
                </div>

                <div>
                  <label className="block font-semibold text-gray-700 mb-2">Contact</label>
                  <input
                    type="text"
                    value={formData.contact}
                    onChange={(e) => setFormData({ ...formData, contact: e.target.value })}
                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#004E7C]"
                  />
                </div>
              </div>

              <div style={{ display: 'flex', gap: '16px', marginTop: '32px' }}>
                <button
                  type="button"
                  onClick={onCancel}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: '#d1d5db',
                    color: '#374151',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: 'pointer'
                  }}
                >
                  Cancel
                </button>
                <button
                  type="button"
                  onClick={handleSaveClick}
                  disabled={isSaving}
                  style={{
                    flex: 1,
                    padding: '16px 24px',
                    backgroundColor: isSaving ? '#6B7280' : '#004E7C',
                    color: 'white',
                    borderRadius: '12px',
                    fontWeight: 'bold',
                    fontSize: '18px',
                    border: 'none',
                    cursor: isSaving ? 'wait' : 'pointer',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '8px',
                    boxShadow: '0 4px 6px rgba(0,0,0,0.1)'
                  }}
                >
                  <Save size={20} />
                  <span>{isSaving ? 'Saving...' : 'Save FAQ'}</span>
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    const LDAHApp = () => {
      const [categories, setCategories] = useState([]);
      const [faqs, setFaqs] = useState([]);
      const [selectedCategory, setSelectedCategory] = useState(null);
      const [selected, setSelected] = useState(new Set());
      const [showGuide, setShowGuide] = useState(false);
      const [showAdmin, setShowAdmin] = useState(false);
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [password, setPassword] = useState('');
      const [editingFaq, setEditingFaq] = useState(null);
      const [editingCategory, setEditingCategory] = useState(null);
      const [loading, setLoading] = useState(true);
      const [draggedItem, setDraggedItem] = useState(null);
      const [dragOverItem, setDragOverItem] = useState(null);
      const [saveStatus, setSaveStatus] = useState('');
      const [error, setError] = useState(null);
      const [adminView, setAdminView] = useState('categories'); // 'categories' or 'faqs'

      const ADMIN_PASSWORD = 'ldah2024';

      // Load Categories and FAQs from Firestore
      useEffect(() => {
        const loadData = async () => {
          try {
            await auth.signInAnonymously();
            
            // Load categories
            const categoriesSnapshot = await db.collection('categories').orderBy('order').get();
            const loadedCategories = categoriesSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setCategories(loadedCategories);

            // Load FAQs
            const faqsSnapshot = await db.collection('faqs').orderBy('order').get();
            const loadedFaqs = faqsSnapshot.docs.map(doc => ({
              id: doc.id,
              ...doc.data()
            }));
            setFaqs(loadedFaqs);
            
            console.log('Loaded:', loadedCategories.length, 'categories,', loadedFaqs.length, 'FAQs');
          } catch (error) {
            console.error('Error loading data:', error);
            setError('Could not load data: ' + error.message);
          }
          setLoading(false);
        };

        loadData();
      }, []);

      // Save Category
      const handleSaveCategory = async (category) => {
        setSaveStatus('Saving category...');
        
        try {
          if (!auth.currentUser) {
            await auth.signInAnonymously();
          }
          
          if (category.id) {
            // Update existing
            await db.collection('categories').doc(category.id).set(category);
            setCategories(categories.map(c => c.id === category.id ? category : c));
          } else {
            // Add new
            const categoryToSave = {
              name: category.name,
              order: categories.length + 1
            };
            const docRef = await db.collection('categories').add(categoryToSave);
            setCategories([...categories, { id: docRef.id, ...categoryToSave }]);
          }
          
          setSaveStatus('✓ Category saved!');
        } catch (error) {
          console.error('Error saving category:', error);
          setSaveStatus('⚠️ Error: ' + error.message);
        }
        
        setTimeout(() => setSaveStatus(''), 3000);
        setEditingCategory(null);
      };

      // Delete Category
      const handleDeleteCategory = async (id) => {
        const faqsInCategory = faqs.filter(f => f.categoryId === id);
        if (faqsInCategory.length > 0) {
          alert(`Cannot delete category. It contains ${faqsInCategory.length} FAQ(s). Please reassign or delete those FAQs first.`);
          return;
        }

        if (confirm('Are you sure you want to delete this category?')) {
          try {
            await db.collection('categories').doc(id).delete();
            setCategories(categories.filter(c => c.id !== id));
          } catch (error) {
            console.error('Error deleting category:', error);
            alert('Error deleting category: ' + error.message);
          }
        }
      };

      // Save FAQ
      const handleSaveFaq = async (faq) => {
        setSaveStatus('Saving FAQ...');
        
        try {
          if (!auth.currentUser) {
            await auth.signInAnonymously();
          }
          
          if (faq.id) {
            // Update existing
            await db.collection('faqs').doc(faq.id).set(faq);
            setFaqs(faqs.map(f => f.id === faq.id ? faq : f));
          } else {
            // Add new - get the max order for this category
            const faqsInCategory = faqs.filter(f => f.categoryId === faq.categoryId);
            const faqToSave = {
              question: faq.question,
              summary: faq.summary,
              steps: faq.steps,
              contact: faq.contact,
              categoryId: faq.categoryId,
              order: faqsInCategory.length + 1
            };
            const docRef = await db.collection('faqs').add(faqToSave);
            setFaqs([...faqs, { id: docRef.id, ...faqToSave }]);
          }
          
          setSaveStatus('✓ FAQ saved!');
        } catch (error) {
          console.error('Error saving FAQ:', error);
          setSaveStatus('⚠️ Error: ' + error.message);
        }
        
        setTimeout(() => setSaveStatus(''), 3000);
        setEditingFaq(null);
      };

      // Delete FAQ
      const handleDeleteFaq = async (id) => {
        if (confirm('Are you sure you want to delete this FAQ?')) {
          try {
            await db.collection('faqs').doc(id).delete();
            setFaqs(faqs.filter(f => f.id !== id));
          } catch (error) {
            console.error('Error deleting FAQ:', error);
            alert('Error deleting FAQ: ' + error.message);
          }
        }
      };

      const handleLogin = (e) => {
        e.preventDefault();
        if (password === ADMIN_PASSWORD) {
          setIsAuthenticated(true);
          setPassword('');
        } else {
          alert('Incorrect password');
          setPassword('');
        }
      };

      const toggleSelection = (faqId) => {
        const newSelected = new Set(selected);
        if (newSelected.has(faqId)) {
          newSelected.delete(faqId);
        } else {
          newSelected.add(faqId);
        }
        setSelected(newSelected);
      };

      // Drag and drop handlers for categories
      const handleCategoryDragStart = (e, index) => {
        setDraggedItem(index);
        e.dataTransfer.effectAllowed = 'move';
      };

      const handleCategoryDragOver = (e, index) => {
        e.preventDefault();
        setDragOverItem(index);
      };

      const handleCategoryDrop = async (e, dropIndex) => {
        e.preventDefault();
        
        if (draggedItem === null || draggedItem === dropIndex) {
          setDraggedItem(null);
          setDragOverItem(null);
          return;
        }

        const newCategories = [...categories];
        const draggedCategory = newCategories[draggedItem];
        newCategories.splice(draggedItem, 1);
        newCategories.splice(dropIndex, 0, draggedCategory);

        // Update orders
        const updatedCategories = newCategories.map((cat, idx) => ({
          ...cat,
          order: idx + 1
        }));

        setCategories(updatedCategories);

        // Save to Firestore
        try {
          const batch = db.batch();
          updatedCategories.forEach(cat => {
            const docRef = db.collection('categories').doc(cat.id);
            batch.update(docRef, { order: cat.order });
          });
          await batch.commit();
        } catch (error) {
          console.error('Error updating category order:', error);
        }

        setDraggedItem(null);
        setDragOverItem(null);
      };

      const handleCategoryDragEnd = () => {
        setDraggedItem(null);
        setDragOverItem(null);
      };

      // Drag and drop handlers for FAQs
      const handleFaqDragStart = (e, index) => {
        setDraggedItem(index);
        e.dataTransfer.effectAllowed = 'move';
      };

      const handleFaqDragOver = (e, index) => {
        e.preventDefault();
        setDragOverItem(index);
      };

      const handleFaqDrop = async (e, dropIndex) => {
        e.preventDefault();
        
        if (draggedItem === null || draggedItem === dropIndex) {
          setDraggedItem(null);
          setDragOverItem(null);
          return;
        }

        const newFaqs = [...faqs];
        const draggedFaq = newFaqs[draggedItem];
        newFaqs.splice(draggedItem, 1);
        newFaqs.splice(dropIndex, 0, draggedFaq);

        // Update orders
        const updatedFaqs = newFaqs.map((faq, idx) => ({
          ...faq,
          order: idx + 1
        }));

        setFaqs(updatedFaqs);

        // Save to Firestore
        try {
          const batch = db.batch();
          updatedFaqs.forEach(faq => {
            const docRef = db.collection('faqs').doc(faq.id);
            batch.update(docRef, { order: faq.order });
          });
          await batch.commit();
        } catch (error) {
          console.error('Error updating FAQ order:', error);
        }

        setDraggedItem(null);
        setDragOverItem(null);
      };

      const handleFaqDragEnd = () => {
        setDraggedItem(null);
        setDragOverItem(null);
      };

      // Loading state
      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
            <div style={{ backgroundColor: 'white', padding: '32px', borderRadius: '16px', textAlign: 'center' }}>
              <div className="text-[#004E7C] text-xl font-bold">Loading...</div>
            </div>
          </div>
        );
      }

      // Error state
      if (error) {
        return (
          <div className="min-h-screen flex items-center justify-center p-4" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
            <div style={{ backgroundColor: 'white', padding: '32px', borderRadius: '16px', maxWidth: '500px' }}>
              <h2 style={{ color: '#004E7C', fontSize: '24px', fontWeight: 'bold', marginBottom: '16px' }}>Oops!</h2>
              <p style={{ color: '#666', marginBottom: '16px' }}>{error}</p>
              <button
                onClick={() => setError(null)}
                style={{
                  marginTop: '16px',
                  backgroundColor: '#004E7C',
                  color: 'white',
                  padding: '12px 24px',
                  borderRadius: '8px',
                  border: 'none',
                  cursor: 'pointer',
                  fontWeight: 'bold'
                }}
              >
                Continue
              </button>
            </div>
          </div>
        );
      }

      // Admin Panel
      if (showAdmin) {
        if (!isAuthenticated) {
          return (
            <div className="min-h-screen flex items-center justify-center p-4" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
              <div style={{
                backdropFilter: 'blur(20px)',
                backgroundColor: 'rgba(255,255,255,0.25)',
                borderRadius: '24px',
                border: '1px solid rgba(255,255,255,0.3)',
                boxShadow: '0 8px 16px rgba(0,0,0,0.1)',
                padding: '32px',
                maxWidth: '28rem',
                width: '100%'
              }}>
                <button
                  onClick={() => setShowAdmin(false)}
                  className="flex items-center gap-2 text-[#004E7C] font-semibold mb-6 hover:opacity-70 transition-opacity"
                >
                  <ChevronLeft size={20} />
                  Back to App
                </button>
                <h2 className="text-2xl font-bold text-[#004E7C] mb-6 text-center">Admin Login</h2>
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  onKeyPress={(e) => {
                    if (e.key === 'Enter') {
                      e.preventDefault();
                      handleLogin(e);
                    }
                  }}
                  placeholder="Enter password"
                  className="w-full px-4 py-3 rounded-xl border-2 border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#004E7C] mb-4"
                  autoFocus
                />
                <button
                  onClick={handleLogin}
                  className="w-full bg-[#004E7C] text-white rounded-xl py-4 font-bold text-lg hover:bg-[#003a5c] transition-colors shadow-lg"
                >
                  Login to Admin Panel
                </button>
              </div>
            </div>
          );
        }

        if (editingCategory !== null) {
          return <CategoryEditor category={editingCategory} onSave={handleSaveCategory} onCancel={() => setEditingCategory(null)} />;
        }

        if (editingFaq !== null) {
          return <FaqEditor faq={editingFaq} categories={categories} onSave={handleSaveFaq} onCancel={() => setEditingFaq(null)} />;
        }

        return (
          <div className="min-h-screen p-4" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
            <div className="max-w-4xl mx-auto">
              <div className="flex justify-between items-center mb-6">
                <button
                  onClick={() => {
                    setShowAdmin(false);
                    setIsAuthenticated(false);
                  }}
                  className="flex items-center gap-2 text-[#004E7C] font-semibold hover:opacity-70"
                >
                  <ChevronLeft size={20} />
                  Back to App
                </button>
                <div className="flex gap-2">
                  <button
                    onClick={() => setAdminView('categories')}
                    style={{
                      backgroundColor: adminView === 'categories' ? '#004E7C' : '#d1d5db',
                      color: adminView === 'categories' ? 'white' : '#374151',
                      padding: '12px 24px',
                      borderRadius: '12px',
                      fontWeight: 'bold',
                      border: 'none',
                      cursor: 'pointer'
                    }}
                  >
                    Categories
                  </button>
                  <button
                    onClick={() => setAdminView('faqs')}
                    style={{
                      backgroundColor: adminView === 'faqs' ? '#004E7C' : '#d1d5db',
                      color: adminView === 'faqs' ? 'white' : '#374151',
                      padding: '12px 24px',
                      borderRadius: '12px',
                      fontWeight: 'bold',
                      border: 'none',
                      cursor: 'pointer'
                    }}
                  >
                    FAQs
                  </button>
                </div>
              </div>

              {saveStatus && (
                <div className="mb-4 text-center">
                  <span className="inline-block bg-blue-100 text-blue-700 px-4 py-2 rounded-lg text-sm font-semibold">
                    {saveStatus}
                  </span>
                </div>
              )}

              {adminView === 'categories' ? (
                <>
                  <div className="flex justify-between items-center mb-6">
                    <h1 className="text-2xl font-bold text-[#004E7C]">Manage Categories</h1>
                    <button
                      onClick={() => setEditingCategory({ name: '', order: categories.length + 1 })}
                      style={{
                        backgroundColor: '#004E7C',
                        color: 'white',
                        padding: '12px 24px',
                        borderRadius: '12px',
                        fontWeight: 'bold',
                        border: 'none',
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px'
                      }}
                    >
                      <Plus size={20} />
                      <span>Add Category</span>
                    </button>
                  </div>

                  <div className="space-y-3">
                    {categories.sort((a, b) => a.order - b.order).map((category, index) => {
                      const faqCount = faqs.filter(f => f.categoryId === category.id).length;
                      return (
                        <div
                          key={category.id}
                          draggable
                          onDragStart={(e) => handleCategoryDragStart(e, index)}
                          onDragEnd={handleCategoryDragEnd}
                          onDragOver={(e) => handleCategoryDragOver(e, index)}
                          onDrop={(e) => handleCategoryDrop(e, index)}
                          className={`bg-white rounded-2xl border shadow-md transition-all ${
                            dragOverItem === index ? 'border-[#004E7C] border-2' : 'border-gray-200'
                          }`}
                          style={{
                            cursor: 'grab',
                            transition: 'all 0.2s ease'
                          }}
                        >
                          <div className="p-4 flex items-center gap-4">
                            <div className="flex-shrink-0 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing">
                              <GripVertical size={24} />
                            </div>
                            
                            <div className="flex-1 min-w-0">
                              <h3 className="font-bold text-lg mb-1 text-gray-900 flex items-center gap-2">
                                <Folder size={20} className="text-[#004E7C]" />
                                {category.name}
                              </h3>
                              <div className="flex items-center gap-3 text-xs text-gray-500">
                                <span className="bg-gray-100 px-2 py-1 rounded-full">
                                  {faqCount} {faqCount === 1 ? 'FAQ' : 'FAQs'}
                                </span>
                                <span className="text-gray-400">•</span>
                                <span>Order: {category.order}</span>
                              </div>
                            </div>
                            
                            <div className="flex gap-2 flex-shrink-0">
                              <button
                                onClick={() => setEditingCategory(category)}
                                className="p-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer' }}
                              >
                                <Edit2 size={18} />
                              </button>
                              <button
                                onClick={() => handleDeleteCategory(category.id)}
                                className="p-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer' }}
                              >
                                <Trash2 size={18} />
                              </button>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </>
              ) : (
                <>
                  <div className="flex justify-between items-center mb-6">
                    <h1 className="text-2xl font-bold text-[#004E7C]">Manage FAQs</h1>
                    <button
                      onClick={() => setEditingFaq({
                        question: '',
                        summary: '',
                        steps: [],
                        contact: '(808) 532-5364',
                        categoryId: categories.length > 0 ? categories[0].id : '',
                        order: faqs.length + 1
                      })}
                      style={{
                        backgroundColor: '#004E7C',
                        color: 'white',
                        padding: '12px 24px',
                        borderRadius: '12px',
                        fontWeight: 'bold',
                        border: 'none',
                        cursor: 'pointer',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '8px'
                      }}
                    >
                      <Plus size={20} />
                      <span>Add FAQ</span>
                    </button>
                  </div>

                  <div className="space-y-3">
                    {faqs.sort((a, b) => a.order - b.order).map((faq, index) => {
                      const category = categories.find(c => c.id === faq.categoryId);
                      return (
                        <div
                          key={faq.id}
                          draggable
                          onDragStart={(e) => handleFaqDragStart(e, index)}
                          onDragEnd={handleFaqDragEnd}
                          onDragOver={(e) => handleFaqDragOver(e, index)}
                          onDrop={(e) => handleFaqDrop(e, index)}
                          className={`bg-white rounded-2xl border shadow-md transition-all ${
                            dragOverItem === index ? 'border-[#004E7C] border-2' : 'border-gray-200'
                          }`}
                          style={{
                            cursor: 'grab',
                            transition: 'all 0.2s ease'
                          }}
                        >
                          <div className="p-4 flex items-center gap-4">
                            <div className="flex-shrink-0 text-gray-400 hover:text-gray-600 cursor-grab active:cursor-grabbing">
                              <GripVertical size={24} />
                            </div>
                            
                            <div className="flex-1 min-w-0">
                              <h3 className="font-bold text-lg mb-1 text-gray-900">{faq.question}</h3>
                              <p className="text-sm text-gray-600 mb-1 line-clamp-2">{faq.summary}</p>
                              <div className="flex items-center gap-3 text-xs text-gray-500">
                                {category && (
                                  <>
                                    <span className="bg-blue-100 text-blue-700 px-2 py-1 rounded-full font-semibold">
                                      {category.name}
                                    </span>
                                    <span className="text-gray-400">•</span>
                                  </>
                                )}
                                {faq.steps && faq.steps.length > 0 && (
                                  <>
                                    <span className="bg-gray-100 px-2 py-1 rounded-full">
                                      {faq.steps.length} {faq.steps.length === 1 ? 'step' : 'steps'}
                                    </span>
                                    <span className="text-gray-400">•</span>
                                  </>
                                )}
                                <span>Order: {faq.order}</span>
                              </div>
                            </div>
                            
                            <div className="flex gap-2 flex-shrink-0">
                              <button
                                onClick={() => setEditingFaq(faq)}
                                className="p-3 bg-blue-500 text-white rounded-xl hover:bg-blue-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer' }}
                              >
                                <Edit2 size={18} />
                              </button>
                              <button
                                onClick={() => handleDeleteFaq(faq.id)}
                                className="p-3 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors shadow-sm"
                                style={{ border: 'none', cursor: 'pointer' }}
                              >
                                <Trash2 size={18} />
                              </button>
                            </div>
                          </div>
                        </div>
                      );
                    })}
                  </div>
                </>
              )}
            </div>
          </div>
        );
      }

      // Action Guide View
      if (showGuide) {
        const selectedFaqs = faqs.filter(faq => selected.has(faq.id));
        
        return (
          <div className="min-h-screen p-4" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
            <div className="max-w-2xl mx-auto">
              <button
                onClick={() => setShowGuide(false)}
                className="flex items-center gap-2 text-[#004E7C] font-semibold mb-4 hover:opacity-70 transition-opacity"
              >
                <ChevronLeft size={20} />
                Back
              </button>
              
              <h1 className="text-2xl font-bold text-[#004E7C] mb-6 text-center">
                My Action Guide
              </h1>
              
              <div style={{
                backdropFilter: 'blur(20px)',
                backgroundColor: 'rgba(255,255,255,0.25)',
                borderRadius: '24px',
                border: '1px solid rgba(255,255,255,0.3)',
                boxShadow: '0 8px 16px rgba(0,0,0,0.1)',
                padding: '24px'
              }}>
                <div className="space-y-8">
                  {selectedFaqs.map((faq, i) => (
                    <div key={faq.id} className="pb-8 border-b border-gray-200 last:border-0 last:pb-0">
                      <h3 className="font-bold text-xl mb-3 text-gray-900">{faq.question}</h3>
                      
                      {faq.summary && (
                        <p className="text-gray-700 mb-4 leading-relaxed">{faq.summary}</p>
                      )}
                      
                      {faq.steps && faq.steps.length > 0 && (
                        <div className="mb-4">
                          <ul className="space-y-3">
                            {faq.steps.map((step, idx) => (
                              <li key={idx} className="flex gap-3 items-start">
                                <div style={{
                                  width: '18px',
                                  height: '18px',
                                  border: '2px solid #004E7C',
                                  borderRadius: '4px',
                                  flexShrink: 0,
                                  marginTop: '3px',
                                  backgroundColor: 'white'
                                }}></div>
                                <span className="font-bold text-[#004E7C]">{idx + 1}.</span>
                                <span className="text-gray-700 flex-1">{step}</span>
                              </li>
                            ))}
                          </ul>
                        </div>
                      )}
                      
                      {faq.contact && (
                        <div className="mt-3 pt-3 border-t border-gray-200">
                          <p className="text-sm text-gray-600">
                            <strong>Contact:</strong>{' '}
                            {(() => {
                              const contact = faq.contact.trim();
                              // Check if it's an email
                              if (contact.includes('@')) {
                                return (
                                  <a 
                                    href={`mailto:${contact}`}
                                    className="text-[#004E7C] underline hover:opacity-70"
                                  >
                                    {contact}
                                  </a>
                                );
                              }
                              // Check if it's a phone number (contains digits and common phone chars)
                              else if (/[\d\(\)\-\s]/.test(contact)) {
                                // Remove all non-digit characters for the tel: link
                                const cleanPhone = contact.replace(/\D/g, '');
                                return (
                                  <a 
                                    href={`tel:${cleanPhone}`}
                                    className="text-[#004E7C] underline hover:opacity-70"
                                  >
                                    {contact}
                                  </a>
                                );
                              }
                              // Otherwise just display as text
                              else {
                                return contact;
                              }
                            })()}
                          </p>
                        </div>
                      )}
                    </div>
                  ))}
                </div>
                
                <div className="mt-6 pt-6 border-t border-gray-200">
                  <button
                    onClick={() => window.print()}
                    className="w-full bg-[#004E7C] text-white rounded-xl py-4 font-bold text-lg hover:bg-[#003a5c] transition-colors shadow-lg flex items-center justify-center gap-2"
                  >
                    <Share size={20} />
                    Print or Share Guide
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      }

      // Category Selection View (Main User View)
      if (!selectedCategory) {
        return (
          <div className="min-h-screen p-2" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
            <div className="max-w-2xl mx-auto">
              {/* Logo Section */}
              <div className="text-center mb-2 mt-2">
                <div className="mb-2 flex justify-center">
                  <div style={{
                    backgroundColor: 'white',
                    borderRadius: '24px',
                    padding: '16px',
                    display: 'inline-block'
                  }}>
                    <img 
                      src="https://danpoahu.github.io/LDAH/logo.jpg" 
                      alt="LDAH Logo"
                      style={{ width: '180px', height: '180px', display: 'block' }}
                    />
                  </div>
                </div>
                
                <h3 className="text-lg font-bold text-[#004E7C] mb-1">
                  Hawaiʻi & Pacific Island Parent Training & Information Center
                </h3>
                <p className="text-gray-600 text-xs mb-2">
                  Empowering families through information, training, and advocacy
                </p>
              </div>

              {/* Admin Button */}
              <div className="flex justify-end mb-4">
                <button
                  onClick={() => setShowAdmin(true)}
                  className="flex items-center gap-2 text-[#004E7C] hover:opacity-70 transition-opacity"
                >
                  <Settings size={20} />
                  <span className="text-sm font-semibold">Admin</span>
                </button>
              </div>

              <h2 className="text-xl font-bold text-[#004E7C] mb-4 text-center">
                Choose a Category
              </h2>

              {categories.length === 0 ? (
                <div style={{
                  backgroundColor: 'white',
                  borderRadius: '24px',
                  padding: '32px',
                  textAlign: 'center'
                }}>
                  <p className="text-gray-600 mb-4">No categories available yet.</p>
                  <button
                    onClick={() => setShowAdmin(true)}
                    className="text-[#004E7C] font-semibold hover:opacity-70"
                  >
                    Add categories in Admin Panel →
                  </button>
                </div>
              ) : (
                <div className="space-y-3">
                  {categories.sort((a, b) => a.order - b.order).map(category => {
                    const categoryFaqs = faqs.filter(f => f.categoryId === category.id);
                    return (
                      <button
                        key={category.id}
                        onClick={() => setSelectedCategory(category)}
                        style={{
                          width: '100%',
                          backgroundColor: 'white',
                          borderRadius: '24px',
                          padding: '24px',
                          cursor: 'pointer',
                          transition: 'all 0.2s',
                          border: 'none',
                          textAlign: 'left'
                        }}
                        onMouseOver={(e) => {
                          e.currentTarget.style.transform = 'translateY(-2px)';
                          e.currentTarget.style.boxShadow = '0 8px 16px rgba(0,0,0,0.1)';
                        }}
                        onMouseOut={(e) => {
                          e.currentTarget.style.transform = 'translateY(0)';
                          e.currentTarget.style.boxShadow = 'none';
                        }}
                      >
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-3">
                            <Folder size={24} className="text-[#004E7C]" />
                            <div>
                              <h3 className="font-bold text-lg text-gray-900">{category.name}</h3>
                              <p className="text-sm text-gray-600">
                                {categoryFaqs.length} {categoryFaqs.length === 1 ? 'question' : 'questions'}
                              </p>
                            </div>
                          </div>
                          <ChevronRight size={24} className="text-[#004E7C]" />
                        </div>
                      </button>
                    );
                  })}
                </div>
              )}

              {/* Show selected count and guide button if any selected */}
              {selected.size > 0 && (
                <div className="mt-6" style={{
                  backgroundColor: 'white',
                  borderRadius: '24px',
                  padding: '20px',
                  textAlign: 'center'
                }}>
                  <p className="text-gray-700 mb-3">
                    <strong>{selected.size}</strong> {selected.size === 1 ? 'question' : 'questions'} selected
                  </p>
                  <button
                    onClick={() => setShowGuide(true)}
                    className="w-full bg-[#004E7C] text-white rounded-xl py-4 font-bold text-lg hover:bg-[#003a5c] transition-colors shadow-lg"
                  >
                    Create My Action Guide →
                  </button>
                </div>
              )}
            </div>
          </div>
        );
      }

      // FAQ Selection View (within a category)
      const categoryFaqs = faqs.filter(f => f.categoryId === selectedCategory.id).sort((a, b) => a.order - b.order);

      return (
        <div className="min-h-screen p-2" style={{ background: 'linear-gradient(135deg, #E3F2FD 0%, #FFEAA7 50%, #FAD4D4 100%)' }}>
          <div className="max-w-2xl mx-auto">
            <button
              onClick={() => setSelectedCategory(null)}
              className="flex items-center gap-2 text-[#004E7C] font-semibold mb-4 hover:opacity-70 transition-opacity"
            >
              <ChevronLeft size={20} />
              Back to Categories
            </button>

            <h2 className="text-xl font-bold text-[#004E7C] mb-2 text-center">
              {selectedCategory.name}
            </h2>
            <p className="text-center text-gray-600 text-sm mb-4">
              Select questions to add to your personalized action guide
            </p>

            {categoryFaqs.length === 0 ? (
              <div style={{
                backgroundColor: 'white',
                borderRadius: '24px',
                padding: '32px',
                textAlign: 'center'
              }}>
                <p className="text-gray-600">No questions in this category yet.</p>
              </div>
            ) : (
              <div className="space-y-3">
                {categoryFaqs.map((faq) => {
                  const isSelected = selected.has(faq.id);
                  return (
                    <div
                      key={faq.id}
                      onClick={() => toggleSelection(faq.id)}
                      style={{
                        backgroundColor: 'white',
                        borderRadius: '24px',
                        padding: '20px',
                        cursor: 'pointer',
                        border: isSelected ? '3px solid #004E7C' : '3px solid transparent',
                        transition: 'all 0.2s'
                      }}
                    >
                      <div className="flex items-start gap-3">
                        <div style={{
                          width: '24px',
                          height: '24px',
                          borderRadius: '8px',
                          border: '2px solid #004E7C',
                          backgroundColor: isSelected ? '#004E7C' : 'white',
                          flexShrink: 0,
                          marginTop: '2px',
                          display: 'flex',
                          alignItems: 'center',
                          justifyContent: 'center'
                        }}>
                          {isSelected && (
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="white" strokeWidth="3">
                              <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                          )}
                        </div>
                        <div className="flex-1">
                          <h3 className="font-bold text-base mb-1 text-gray-900">{faq.question}</h3>
                          {faq.summary && (
                            <p className="text-sm text-gray-600 line-clamp-2">{faq.summary}</p>
                          )}
                        </div>
                      </div>
                    </div>
                  );
                })}
              </div>
            )}

            {/* Action buttons */}
            <div className="mt-6 space-y-3">
              {selected.size > 0 && (
                <div style={{
                  backgroundColor: 'white',
                  borderRadius: '24px',
                  padding: '20px',
                  textAlign: 'center'
                }}>
                  <p className="text-gray-700 mb-3">
                    <strong>{selected.size}</strong> {selected.size === 1 ? 'question' : 'questions'} selected
                  </p>
                  <button
                    onClick={() => setShowGuide(true)}
                    className="w-full bg-[#004E7C] text-white rounded-xl py-4 font-bold text-lg hover:bg-[#003a5c] transition-colors shadow-lg"
                  >
                    Create My Action Guide →
                  </button>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(
      <ErrorBoundary>
        <LDAHApp />
      </ErrorBoundary>, 
      document.getElementById('root')
    );
  </script>
</body>
</html>