<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>LDAH - Events</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: url('https://danpoahu.github.io/LDAH/background.png') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Icons
    const ChevronLeft = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    );

    const Calendar = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
        <line x1="16" y1="2" x2="16" y2="6"></line>
        <line x1="8" y1="2" x2="8" y2="6"></line>
        <line x1="3" y1="10" x2="21" y2="10"></line>
      </svg>
    );

    const Clock = ({ size = 24, className = '' }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="10"></circle>
        <polyline points="12 6 12 12 16 14"></polyline>
      </svg>
    );

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAU3CQ07bCVKlJ1qGak-150kaJEyPKldLk",
      authDomain: "ldah-932d5.firebaseapp.com",
      projectId: "ldah-932d5",
      storageBucket: "ldah-932d5.firebasestorage.app",
      messagingSenderId: "662130454003",
      appId: "1:662130454003:web:437576d5a5811ecd8df686"
    };

    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }

    const db = firebase.firestore();
    const auth = firebase.auth();

    auth.signInAnonymously().catch(error => {
      console.error('Anonymous auth failed:', error);
    });

    const EventsApp = () => {
      const [events, setEvents] = useState([]);
      const [loading, setLoading] = useState(true);

      useEffect(() => {
        const unsubscribe = db.collection('events')
          .onSnapshot(snapshot => {
            const eventList = snapshot.docs.map(doc => ({ 
              id: doc.id, 
              ...doc.data() 
            }));
            setEvents(eventList);
            setLoading(false);
          }, error => {
            console.error('Error loading events:', error);
            setLoading(false);
          });

        return () => unsubscribe();
      }, []);

      const formatDate = (dateString) => {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
          month: 'long', 
          day: 'numeric', 
          year: 'numeric' 
        });
      };

      const isEventCurrent = (event) => {
        const now = new Date();
        const startDate = new Date(event.startDate);
        const moveToPastDate = new Date(event.moveToPastDate);
        return now >= startDate && now < moveToPastDate;
      };

      const isEventPast = (event) => {
        const now = new Date();
        const moveToPastDate = new Date(event.moveToPastDate);
        const removeDate = new Date(event.removeDate);
        return now >= moveToPastDate && now < removeDate;
      };

      const currentEvents = events.filter(isEventCurrent).sort((a, b) => 
        new Date(a.startDate) - new Date(b.startDate)
      );

      const pastEvents = events.filter(isEventPast).sort((a, b) => 
        new Date(b.moveToPastDate) - new Date(a.moveToPastDate)
      );

      if (loading) {
        return (
          <div className="min-h-screen flex items-center justify-center" style={{ background: "url('https://danpoahu.github.io/LDAH/background.png') no-repeat center center fixed", backgroundSize: 'cover' }}>
            <div style={{ backgroundColor: 'white', padding: '32px', borderRadius: '24px', textAlign: 'center' }}>
              <p className="text-[#004E7C] font-semibold">Loading events...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen p-2" style={{ background: "url('https://danpoahu.github.io/LDAH/background.png') no-repeat center center fixed", backgroundSize: 'cover' }}>
          <div className="max-w-2xl mx-auto">
            {/* Header with Logo */}
            <div className="text-center mb-4 mt-2">
              <div className="mb-2 flex justify-center">
                <a href="index.html" style={{ textDecoration: 'none' }}>
                  <div style={{
                    padding: '16px',
                    display: 'inline-block',
                    cursor: 'pointer',
                    transition: 'transform 0.2s'
                  }}
                  onMouseOver={(e) => e.currentTarget.style.transform = 'scale(1.05)'}
                  onMouseOut={(e) => e.currentTarget.style.transform = 'scale(1)'}
                  >
                    <img 
                      src="https://danpoahu.github.io/LDAH/logo_transparent.png" 
                      alt="LDAH Logo"
                      style={{ width: '120px', height: '120px', display: 'block' }}
                    />
                  </div>
                </a>
              </div>
              <h1 className="text-2xl font-bold text-[#004E7C] mb-1">Events</h1>
              <p className="text-gray-600 text-sm mb-2">
                Stay updated with our upcoming events and activities
              </p>
            </div>

            {/* Current Events */}
            {currentEvents.length > 0 && (
              <>
                <h2 className="text-xl font-bold text-[#004E7C] mb-3 text-center">Upcoming Events</h2>
                <div className="space-y-4 mb-8">
                  {currentEvents.map(event => (
                    <div 
                      key={event.id}
                      style={{
                        backgroundColor: 'white',
                        borderRadius: '24px',
                        padding: '24px',
                        border: '2px solid #004E7C'
                      }}
                    >
                      {event.imageUrl && (
                        <img 
                          src={event.imageUrl}
                          alt={event.title}
                          style={{
                            width: '100%',
                            borderRadius: '16px',
                            marginBottom: '16px',
                            maxHeight: '400px',
                            objectFit: 'cover'
                          }}
                        />
                      )}
                      <h3 className="text-xl font-bold text-gray-900 mb-2">{event.title}</h3>
                      <div className="flex items-center gap-2 text-sm text-[#004E7C] mb-3">
                        <Calendar size={16} />
                        <span>{formatDate(event.eventDate)}</span>
                      </div>
                      <p className="text-gray-700 text-sm leading-relaxed whitespace-pre-wrap">
                        {event.description}
                      </p>
                    </div>
                  ))}
                </div>
              </>
            )}

            {/* Past Events */}
            {pastEvents.length > 0 && (
              <>
                <h2 className="text-xl font-bold text-[#004E7C] mb-3 text-center">Past Events</h2>
                <div className="space-y-4 mb-8">
                  {pastEvents.map(event => (
                    <div 
                      key={event.id}
                      style={{
                        backgroundColor: 'white',
                        borderRadius: '24px',
                        padding: '24px',
                        border: '2px solid #9CA3AF',
                        opacity: 0.8
                      }}
                    >
                      {event.imageUrl && (
                        <img 
                          src={event.imageUrl}
                          alt={event.title}
                          style={{
                            width: '100%',
                            borderRadius: '16px',
                            marginBottom: '16px',
                            maxHeight: '300px',
                            objectFit: 'cover',
                            filter: 'grayscale(30%)'
                          }}
                        />
                      )}
                      <h3 className="text-lg font-bold text-gray-700 mb-2">{event.title}</h3>
                      <div className="flex items-center gap-2 text-sm text-gray-500 mb-3">
                        <Calendar size={16} />
                        <span>{formatDate(event.eventDate)}</span>
                      </div>
                      <p className="text-gray-600 text-sm leading-relaxed whitespace-pre-wrap">
                        {event.description}
                      </p>
                    </div>
                  ))}
                </div>
              </>
            )}

            {/* No Events */}
            {currentEvents.length === 0 && pastEvents.length === 0 && (
              <div style={{
                backgroundColor: 'white',
                borderRadius: '24px',
                padding: '48px',
                textAlign: 'center',
                border: '2px solid #004E7C'
              }}>
                <Calendar size={48} className="text-gray-400 mx-auto mb-4" />
                <p className="text-gray-600 text-lg">No events scheduled at this time.</p>
                <p className="text-gray-500 text-sm mt-2">Check back soon for upcoming events!</p>
              </div>
            )}

            {/* Back Button */}
            <div className="mt-6 text-center">
              <a 
                href="index.html"
                className="inline-flex items-center gap-2 text-[#004E7C] font-semibold hover:opacity-70 transition-opacity"
              >
                <ChevronLeft size={20} />
                Back to Home
              </a>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<EventsApp />, document.getElementById('root'));
  </script>
</body>
</html>
